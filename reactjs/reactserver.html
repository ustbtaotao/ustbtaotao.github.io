<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
    <title>
        
        reactå®ç°æœåŠ¡å™¨æ¸²æŸ“ |
        
        iå’–å•¡</title>
    <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="generator" content="iå’–å•¡">
    <meta name="author" content="ustbtaotao">
    
    <meta name="keywords" content="reactjs,æœåŠ¡å™¨æ¸²æŸ“,react+redux+router+webpack">
    
    
    <meta name="description" content="reactå®ç°æœåŠ¡å™¨æ¸²æŸ“,react + redux + node + mongodb">
    
    <meta name="wumiiVerification" content="7ae830d3-0185-462c-9371-29173dc04418"/>
    <meta name="baidu_union_verify" content="325fd53fb77cfb471e02dc44b9106274">
    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href=" /atom.xml "
          title="iå’–å•¡" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css"/>
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <script src="/js/search.js"></script>
    <![endif]-->

    
    
    
    <style>.col-md-8.col-md-offset-2.opening-statement img {
            display: none;
        }</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

<!-- ============================ Off-canvas navigation =========================== -->

<div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling" xmlns="http://www.w3.org/1999/html"
 style="background-color: rgba(21, 21, 21, 0.88);"
>
    <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
        <img src="/img/close.png" alt="Close"/>
    </div>
    <!-- Lists in Slidebars -->
    <ul class="sb-menu">
        <li><a href="/" class="animsition-link" title="Home">Home</a></li>
        <li><a href="/archives" class="animsition-link" title="archive">æ‰€æœ‰æ–‡ç« </a>
        </li>
        <!-- Dropdown Menu -->
        
        
        <li>
            <a class="sb-toggle-submenu">æŒ‰åˆ†ç±»<span class="sb-caret"></span></a>
            <ul class="sb-submenu">
                
                <li><a href="/categories/electron/" class="animsition-link">electron
                        <small>(1)</small>
                    </a></li>
                
                <li><a href="/categories/git/" class="animsition-link">git
                        <small>(1)</small>
                    </a></li>
                
                <li><a href="/categories/hexo/" class="animsition-link">hexo
                        <small>(7)</small>
                    </a></li>
                
                <li><a href="/categories/html/" class="animsition-link">html
                        <small>(3)</small>
                    </a></li>
                
                <li><a href="/categories/javascript/" class="animsition-link">javascript
                        <small>(6)</small>
                    </a></li>
                
                <li><a href="/categories/kettle/" class="animsition-link">kettle
                        <small>(4)</small>
                    </a></li>
                
                <li><a href="/categories/linux/" class="animsition-link">linux
                        <small>(2)</small>
                    </a></li>
                
                <li><a href="/categories/mongo/" class="animsition-link">mongo
                        <small>(10)</small>
                    </a></li>
                
                <li><a href="/categories/nodejs/" class="animsition-link">nodejs
                        <small>(18)</small>
                    </a></li>
                
                <li><a href="/categories/reactjs/" class="animsition-link">reactjs
                        <small>(26)</small>
                    </a></li>
                
                <li><a href="/categories/svn/" class="animsition-link">svn
                        <small>(1)</small>
                    </a></li>
                
                <li><a href="/categories/other/" class="animsition-link">å…¶ä»–
                        <small>(1)</small>
                    </a></li>
                
                <li><a href="/categories/baby/" class="animsition-link">å°å°æ¥ç­äºº
                        <small>(1)</small>
                    </a></li>
                
                <li><a href="/categories/server/" class="animsition-link">æœåŠ¡
                        <small>(1)</small>
                    </a></li>
                
            </ul>
        </li>
        
        
        <li>
            <a class="sb-toggle-submenu" id="tabs">æŒ‰æ ‡ç­¾<span class="sb-caret"></span></a>
            <ul class="sb-submenu">
                
                <li><a href="/tags/reactjs/" class="animsition-link">reactjs
                        <small>(27)</small>
                    </a></li>
                
                <li><a href="/tags/component/" class="animsition-link">ç»„ä»¶
                        <small>(5)</small>
                    </a></li>
                
                <li><a href="/tags/electron/" class="animsition-link">electron
                        <small>(1)</small>
                    </a></li>
                
                <li><a href="/tags/hexo/" class="animsition-link">hexo
                        <small>(7)</small>
                    </a></li>
                
                <li><a href="/tags/other/" class="animsition-link">å…¶ä»–
                        <small>(3)</small>
                    </a></li>
                
                <li><a href="/tags/git/" class="animsition-link">git
                        <small>(1)</small>
                    </a></li>
                
                <li><a href="/tags/html/" class="animsition-link">html
                        <small>(3)</small>
                    </a></li>
                
                <li><a href="/tags/javascript/" class="animsition-link">javascript
                        <small>(22)</small>
                    </a></li>
                
                <li><a href="/tags/kettle/" class="animsition-link">kettle
                        <small>(4)</small>
                    </a></li>
                
                <li><a href="/tags/linux/" class="animsition-link">linux
                        <small>(2)</small>
                    </a></li>
                
                <li><a href="/tags/mongo/" class="animsition-link">mongo
                        <small>(10)</small>
                    </a></li>
                
                <li><a href="/tags/nodejs/" class="animsition-link">nodejs
                        <small>(19)</small>
                    </a></li>
                
                <li><a href="/tags/highchart/" class="animsition-link">highchart
                        <small>(3)</small>
                    </a></li>
                
                <li><a href="/tags/jquery/" class="animsition-link">jquery
                        <small>(1)</small>
                    </a></li>
                
                <li><a href="/tags/webpack/" class="animsition-link">webpack
                        <small>(2)</small>
                    </a></li>
                
                <li><a href="/tags/svn/" class="animsition-link">svn
                        <small>(2)</small>
                    </a></li>
                
                <li><a href="/tags/server/" class="animsition-link">æœåŠ¡
                        <small>(1)</small>
                    </a></li>
                
                <li><a href="/tags/es6/" class="animsition-link">es6
                        <small>(1)</small>
                    </a></li>
                
                <li><a href="/tags/baby/" class="animsition-link">å°å°æ¥ç­äºº
                        <small>(1)</small>
                    </a></li>
                
            </ul>
        </li>
        
        
        <li>
            <a class="sb-toggle-submenu">å‹æƒ…é“¾æ¥<span class="sb-caret"></span></a>
            <ul class="sb-submenu">
                
                <li><a href="http://tool.chinaz.com/" target="_blank" >ç«™é•¿å·¥å…·</a></li>
                
                <li><a href="http://www.weishao.com.cn/" target="_blank" >é”æ·ç½‘ç»œ_å¾®å“¨</a></li>
                
                <li><a href=" http://www.pangshunlong.com/" target="_blank" >åºé¡ºé¾™çš„åšå®¢</a></li>
                
            </ul>
        </li>
        
    </ul>
    <!-- Lists in Slidebars -->
    <ul class="sb-menu secondary">
        <li><a href="http://www.icafebolger.comabout.html" class="animsition-link" title="about">About</a></li>
        <li style="display: none;"><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
    </ul>
</div>

<!-- ============================ END Off-canvas navigation =========================== -->

<!-- ============================ #sb-site Main Page Wrapper =========================== -->

<div id="sb-site">
    <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

    <!-- ============================ Header & Logo bar =========================== -->

    <div id="navigation" class="navbar navbar-fixed-top">
        <div id="site_search" class="sitesearch">
            <div class="form-group">
                <input type="text" id="local-search-input" name="q" results="0" placeholder="search"
                       class="st-search-input st-default-search-input form-control"/>
            </div>
            <div id="local-search-result" class="searchresult"></div>
        </div>
        <div class="navbar-inner" style="background-color: #e8acac;">
            <div class="container">
                <!-- Nav logo -->
                <div class="logo">
                    <a href="/" title="Logo" class="animsition-link">
                        
                        <img src="/img/logo.png" alt="Logo" width="35px;"/>
                        
                    </a>
                </div>
                <!-- // Nav logo -->
                <!-- Info-bar -->
                <nav>
                    <ul class="nav">
                        <li><a href="/" class="animsition-link" style="color: #ffffff;">iå’–å•¡</a></li>
                        
                        
                        <li><a href="http://weibo.com/ustbtaotao" title="Sina-Weibo" target="_blank" style="color: #ffffff;"><i
                                        class="icon-sina-weibo" style="color: #ffffff;"></i>å¾®åš</a></li>
                        
                        <li class="nolink" style="color: #ffffff;"><span>Welcome!</span></li>
                    </ul>
                </nav>
                <!--// Info-bar -->
            </div>
            <!-- // .container -->
            <div class="learnmore sb-toggle-right" style="display: none;">More</div>
            <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
            </button>
        </div>
        <!-- // .navbar-inner -->
    </div>

    <!-- ============================ Header & Logo bar =========================== -->



<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
                <span class="post-meta">
      <time datetime="2018-03-07T07:08:43.000Z" itemprop="datePublished">
          2018-03-07
      </time>
    
    
    
    | 
    <a href='/tags/reactjs/'>reactjs</a>
    
    
    <br />
    å­—æ•°:<span class="post-count">7,298</span>
</span>
                é˜…è¯»æ•°:
                <span id="/reactjs/reactserver.html" data_time="Wed Mar 07 2018 15:08:43 GMT+0800" class="leancloud_visitors" data-flag-title="reactå®ç°æœåŠ¡å™¨æ¸²æŸ“"></span>æ¬¡
                
                <h1>reactå®ç°æœåŠ¡å™¨æ¸²æŸ“</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
            <div class="bshare-custom" style="float: right;">
                <div class="bsPromo bsPromo2"></div>
                <a title="åˆ†äº«åˆ°å¾®ä¿¡" class="bshare-weixin" href="javascript:void(0);"></a>
                <a title="åˆ†äº«åˆ°æ–°æµªå¾®åš" class="bshare-sinaminiblog" href="javascript:void(0);"></a>
                <a title="åˆ†äº«åˆ°QQç©ºé—´" class="bshare-qzone"></a>
                <a title="åˆ†äº«åˆ°äººäººç½‘" class="bshare-renren"></a>
                <a title="åˆ†äº«åˆ°è…¾è®¯å¾®åš" class="bshare-qqmb"></a>
                <a title="æ›´å¤šå¹³å°" class="bshare-more bshare-more-icon more-style-addthis"></a>
                <span class="BSHARE_COUNT bshare-share-count" style="float: none;">0</span></div>
            <div style="margin-top: 10px;" id="content">
                <h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>ä¹‹å‰æˆ‘ä»¬æ‰€æœ‰çš„react spaé¡¹ç›®éƒ½æ˜¯å‰åç«¯åˆ†ç¦»çš„å®¢æˆ·ç«¯æ¸²æŸ“ï¼Œå³é€šè¿‡renderçš„æ–¹å¼è¿›è¡ŒUIå‘ˆç°ï¼Œé€šè¿‡ajaxæˆ–è€…fetchè¿›è¡Œapiå¼‚æ­¥è¯·æ±‚æ•°æ®ã€‚  é—²æš‡æœŸé—´æ¥è§¦åˆ°äº†reactæœåŠ¡å™¨æ¸²æŸ“æ–¹å¼ï¼Œå†³å®šç ”ç©¶ç ”ç©¶ã€‚ä¸ºä»€ä¹ˆè¦è¯´æœåŠ¡å™¨ç«¯æ¸²æŸ“å‘¢ï¼ŸæŸ¥äº†äº›å¸–å­å’Œèµ„æ–™ï¼Œæ— éä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š<br>1ã€ä»£ç å¤ç”¨ï¼›<br>2ã€åˆ©äºSEOï¼Œå› ä¸ºæ•´ä¸ªhtmléƒ½æ˜¯ç”±nodeåå°ç”Ÿæˆå¥½ç›´æ¥è¾“å‡ºåˆ°å‰ç«¯çš„ã€‚<br>3ã€æå‡é¦–å±åŠ è½½é€Ÿåº¦</p>
<p>ä¸ºäº†æ›´å¥½æ›´å¿«çš„å­¦ä¹ ï¼Œè¿™é‡Œç»™å¤§å®¶åˆ†äº«ä¸€ä¸ªé¡¹ç›®ï¼Œæ­¥éª¤è¯´æ˜å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œæˆ‘ä¸å†èµ˜è¿°ï¼Œè¿™é‡Œåˆ†äº«å‡ºé¡¹ç›®çš„<a href="https://pan.baidu.com/s/1d9n6SJiDhXsxMwKfLnvKUA" target="_blank" rel="noopener">æºç </a>ã€‚è¿è¡Œå‰å…ˆå»ºç«‹mongoæ•°æ®åº“ï¼Œå»ºç«‹open_cookåº“ï¼Œæ–°å»ºuserå’Œrecipeè¡¨ï¼Œç»“æ„å‚è§src/server/models;mongooseé…ç½®ä¿®æ”¹src/server/config/index.js databaseèŠ‚ç‚¹<br>ä¸‹è½½åç›´æ¥npm install ç„¶ånpm run start å³å¯ã€‚å…·ä½“å®ç°é€»è¾‘çœ‹ä¸‹è¾¹ï¼ï¼ï¼ï¼ï¼&gt;&gt;&gt;&gt;</p>
<h2 id="åˆ†äº«"><a href="#åˆ†äº«" class="headerlink" title="åˆ†äº«"></a>åˆ†äº«</h2><p>ç”¨ React + Redux + Nodeï¼ˆIsomorphic JavaScriptï¼‰å¼€å‘é£Ÿè°±åˆ†äº«ç½‘ç«™</p>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¦‚æœä½ æ˜¯ä»ä¸€å¼€å§‹è·Ÿè‘—æˆ‘ä»¬è¸å‡º React æ—…ç¨‹çš„è¯»è€…çœŸçš„æ­å–œä½ ï¼Œä¹Ÿè°¢è°¢ä½ ä¸€è·¯è·Ÿè‘—æˆ‘ä»¬çš„å­¦ä¹ è„šæ­¥ï¼Œå¯¹ä¸€ä¸ªåˆå­¦è€…æ¥è¯´è¿™ä¸€æ®µè·¯å¹¶ä¸å®¹æ˜“ã€‚æœ¬ç« æ˜¯æ‰£é™¤é™„å½•å¤–æˆ‘ä»¬æœ€åä¸€ä¸ªæ­£å¼ç« èŠ‚çš„èŒƒä¾‹ï¼Œä¹Ÿæ˜¯è§„æ¨¡æœ€å¤§çš„ä¸€ä¸ªï¼Œåœ¨è¿™ä¸ªç« èŠ‚ä¸­æˆ‘ä»¬è¦æ•´åˆè¿‡å»æ‰€å­¦å’Œæ·»åŠ ä¸€äº›çŸ¥è¯†å¼€å‘ä¸€ä¸ªå¯ä»¥ç™»å…¥ä¼šå‘˜å¹¶åˆ†äº«é£Ÿè°±çš„ç¤¾ç¾¤ç½‘ç«™ï¼ŒLesâ€™s GOï¼</p>
<h2 id="éœ€æ±‚è§„åˆ’"><a href="#éœ€æ±‚è§„åˆ’" class="headerlink" title="éœ€æ±‚è§„åˆ’"></a>éœ€æ±‚è§„åˆ’</h2><p>è®©ä½¿ç”¨è€…å¯ä»¥ç™»å…¥ä¼šå‘˜å¹¶åˆ†äº«é£Ÿè°±çš„ç¤¾ç¾¤ç½‘ç«™</p>
<h2 id="åŠŸèƒ½è§„åˆ’"><a href="#åŠŸèƒ½è§„åˆ’" class="headerlink" title="åŠŸèƒ½è§„åˆ’"></a>åŠŸèƒ½è§„åˆ’</h2><ol>
<li>React Router / Redux / Immutable / Server Render / Async API</li>
<li>ä½¿ç”¨è€…ç™»å…¥/ç™»å‡ºï¼ˆJSON Web Tokenï¼‰</li>
<li>CRUD è¡¨å•èµ„æ–™å¤„ç†</li>
<li>èµ„æ–™åº“ä¸²æ¥(ORM/MongoDB)</li>
</ol>
<h2 id="ä½¿ç”¨æŠ€æœ¯"><a href="#ä½¿ç”¨æŠ€æœ¯" class="headerlink" title="ä½¿ç”¨æŠ€æœ¯"></a>ä½¿ç”¨æŠ€æœ¯</h2><ol>
<li>React</li>
<li>Redux(redux-actions/redux-promise/redux-immutable)</li>
<li>React Router</li>
<li>ImmutableJS</li>
<li>Node MongoDB ORM(Mongoose)</li>
<li>JSON Web Token</li>
<li>React Bootstrap</li>
<li>Axios(Promise)</li>
<li>Webpack</li>
<li>UUID</li>
</ol>
<h2 id="ä¸“æ¡ˆæˆæœæˆªå›¾"><a href="#ä¸“æ¡ˆæˆæœæˆªå›¾" class="headerlink" title="ä¸“æ¡ˆæˆæœæˆªå›¾"></a>ä¸“æ¡ˆæˆæœæˆªå›¾</h2><p><img src="/image/react/open-cook-demo-1.png" alt="ç”¨ React + Redux + Nodeï¼ˆIsomorphicï¼‰å¼€å‘ä¸€ä¸ªé£Ÿè°±åˆ†äº«ç½‘ç«™" title="ç”¨ React + Redux + Nodeï¼ˆIsomorphicï¼‰å¼€å‘ä¸€ä¸ªé£Ÿè°±åˆ†äº«ç½‘ç«™"></p>
<p><img src="/image/react/open-cook-demo-2.png" alt="ç”¨ React + Redux + Nodeï¼ˆIsomorphicï¼‰å¼€å‘ä¸€ä¸ªé£Ÿè°±åˆ†äº«ç½‘ç«™" title="ç”¨ React + Redux + Nodeï¼ˆIsomorphicï¼‰å¼€å‘ä¸€ä¸ªé£Ÿè°±åˆ†äº«ç½‘ç«™"></p>
<p><img src="/image/react/open-cook-demo-3.png" alt="ç”¨ React + Redux + Nodeï¼ˆIsomorphicï¼‰å¼€å‘ä¸€ä¸ªé£Ÿè°±åˆ†äº«ç½‘ç«™" title="ç”¨ React + Redux + Nodeï¼ˆIsomorphicï¼‰å¼€å‘ä¸€ä¸ªé£Ÿè°±åˆ†äº«ç½‘ç«™"></p>
<p><img src="/image/react/open-cook-demo-4.png" alt="ç”¨ React + Redux + Nodeï¼ˆIsomorphicï¼‰å¼€å‘ä¸€ä¸ªé£Ÿè°±åˆ†äº«ç½‘ç«™" title="ç”¨ React + Redux + Nodeï¼ˆIsomorphicï¼‰å¼€å‘ä¸€ä¸ªé£Ÿè°±åˆ†äº«ç½‘ç«™"></p>
<h2 id="ç¯å¢ƒå®‰è£…ä¸è®¾å®š"><a href="#ç¯å¢ƒå®‰è£…ä¸è®¾å®š" class="headerlink" title="ç¯å¢ƒå®‰è£…ä¸è®¾å®š"></a>ç¯å¢ƒå®‰è£…ä¸è®¾å®š</h2><ol>
<li><p>å®‰è£… Node å’Œ NPM</p>
</li>
<li><p>å®‰è£…æ‰€éœ€å¥—ä»¶</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save react react-dom redux react-redux react-router immutable redux-immutable redux-actions redux-promise bcrypt body-parser cookie-parser debug express immutable jsonwebtoken mongoose morgan passport passport-local react-router-bootstrap axios serve-favicon validator uuid</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save-dev babel-core babel-eslint babel-loader babel-preset-es2015 babel-preset-react babel-preset-stage-1 eslint eslint-config-airbnb eslint-loader eslint-plugin-import eslint-plugin-jsx-a11y eslint-plugin-react html-webpack-plugin webpack webpack-dev-server redux-logger</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆè®¾å®šä¸€ä¸‹å¼€å‘æ–‡æ¡£ã€‚</p>
<ol>
<li><p>è®¾å®š Babel çš„è®¾å®šæ¡£ï¼š <code>.babelrc</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [</span><br><span class="line">    <span class="string">"es2015"</span>,</span><br><span class="line">    <span class="string">"react"</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"plugins"</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è®¾å®š ESLint çš„è®¾å®šæ¡£å’Œè§„åˆ™ï¼š <code>.eslintrc</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"extends"</span>: <span class="string">"airbnb"</span>,</span><br><span class="line">  <span class="string">"rules"</span>: &#123;</span><br><span class="line">    <span class="string">"react/jsx-filename-extension"</span>: [<span class="number">1</span>, &#123; <span class="string">"extensions"</span>: [<span class="string">".js"</span>, <span class="string">".jsx"</span>] &#125;],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"env"</span> :&#123;</span><br><span class="line">    <span class="string">"browser"</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è®¾å®š Webpack è®¾å®šæ¡£ï¼š <code>webpack.config.js</code>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> webpack <span class="keyword">from</span> <span class="string">'webpack'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: [</span><br><span class="line">    <span class="string">'./src/client/index.js'</span>,</span><br><span class="line">  ],</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: <span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/dist`</span>,</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">    publicPath: <span class="string">'/static/'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    preLoaders: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.jsx$|\.js$/</span>,</span><br><span class="line">        loader: <span class="string">'eslint-loader'</span>,</span><br><span class="line">        include: <span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/app`</span>,</span><br><span class="line">        exclude: <span class="regexp">/bundle\.js$/</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ Hot Module Replacement å¤–æŒ‚</span></span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> webpack.optimize.OccurrenceOrderPlugin(),</span><br><span class="line">      <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">    ],    </span><br><span class="line">    loaders: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">      query: &#123;</span><br><span class="line">        presets: [<span class="string">'es2015'</span>, <span class="string">'react'</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è®¾å®š <code>src/server/config/index.js</code>ï¼š</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (&#123;</span><br><span class="line">  <span class="string">"secret"</span>: <span class="string">"ilovecooking"</span>,</span><br><span class="line">  <span class="string">"database"</span>: <span class="string">"mongodb://localhost/open_cook"</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å¤ªå¥½äº†ï¼è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†å¼€å‘ç¯å¢ƒçš„è®¾å®šå¯ä»¥å¼€å§‹åŠ¨æ‰‹å®ä½œæˆ‘ä»¬çš„é£Ÿè°±åˆ†äº«ç¤¾ç¾¤åº”ç”¨ç¨‹å¼äº†ï¼  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">åŒæ—¶æˆ‘ä»¬ä¹Ÿåˆæ­¥è®¾è®¡æˆ‘ä»¬èµ„æ–™å¤¹ç»“æ„ï¼Œä¸»è¦æˆ‘ä»¬å°†èµ„æ–™å¤¹åˆ†ä¸º `</span>client<span class="string">`ã€`</span>common<span class="string">`ã€`</span>server<span class="string">`ï¼š</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">![ç”¨ React + Redux + Nodeï¼ˆIsomorphicï¼‰å¼€å‘ä¸€ä¸ªé£Ÿè°±åˆ†äº«ç½‘ç«™](./images/open-cook-demo-folder.png "ç”¨ React + Redux + Nodeï¼ˆIsomorphicï¼‰å¼€å‘ä¸€ä¸ªé£Ÿè°±åˆ†äº«ç½‘ç«™")</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## åŠ¨æ‰‹å®ä½œ</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">é¦–å…ˆæˆ‘ä»¬å…ˆè¿›è¡Œ `</span>src/client/index.js<span class="string">` çš„è®¾è®¡ï¼š</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; browserHistory, Router &#125; <span class="keyword">from</span> <span class="string">'react-router'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fromJS &#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</span><br><span class="line"><span class="comment">// æˆ‘ä»¬çš„ routing æ”¾ç½®åœ¨ common èµ„æ–™å¤¹ä¸­çš„ routes</span></span><br><span class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">'../common/routes'</span>;</span><br><span class="line"><span class="keyword">import</span> configureStore <span class="keyword">from</span> <span class="string">'../common/store/configureStore'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; checkAuth &#125; <span class="keyword">from</span> <span class="string">'../common/actions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°† server side ä¼ è¿‡æ¥çš„ initialState ç»™ rehydrationï¼ˆè¦†æ°´ï¼‰</span></span><br><span class="line"><span class="keyword">const</span> initialState = <span class="built_in">window</span>.__PRELOADED_STATE__;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°† initialState ä¼ ç»™ configureStore å‡½æ•°åˆ›å»ºå‡º store å¹¶ä¼ ç»™ Provider</span></span><br><span class="line"><span class="keyword">const</span> store = configureStore(fromJS(initialState));</span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;Router history=&#123;browserHistory&#125; routes=&#123;routes&#125; /&gt;</span><br><span class="line">  &lt;<span class="regexp">/Provider&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById('app')</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>
<p>ç”±äº Node ç«¯è¦åˆ°æ–°ç‰ˆå¯¹äº ES6 æ”¯æ´è¾ƒå¥½ï¼Œæ‰€ä»¥å…ˆç”¨ <code>babel-register</code> åœ¨ <code>src/server/index.js</code> å»å³æ—¶è½¬è¯‘ <code>server.js</code>ï¼Œä½†ä¸å»ºè®®åœ¨ <code>production</code> ç¯å¢ƒä½¿ç”¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// use babel-register to precompile ES6 </span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'babel-register'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./server'</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ Expressã€mongooseï¼ˆMongoDB ORMï¼‰ä»¥åŠç›¸å…³ server ä¸Šä½¿ç”¨çš„å¥—ä»¶</span></span><br><span class="line"><span class="comment">/* Server Packages */</span></span><br><span class="line"><span class="keyword">import</span> Express <span class="keyword">from</span> <span class="string">'express'</span>;</span><br><span class="line"><span class="keyword">import</span> bodyParser <span class="keyword">from</span> <span class="string">'body-parser'</span>;</span><br><span class="line"><span class="keyword">import</span> cookieParser <span class="keyword">from</span> <span class="string">'cookie-parser'</span>;</span><br><span class="line"><span class="keyword">import</span> morgan <span class="keyword">from</span> <span class="string">'morgan'</span>;</span><br><span class="line"><span class="keyword">import</span> mongoose <span class="keyword">from</span> <span class="string">'mongoose'</span>;</span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">'./config'</span>;</span><br><span class="line"><span class="comment">// å¼•å…¥åç«¯ model é€è¿‡ model å’Œèµ„æ–™åº“äº’åŠ¨ </span></span><br><span class="line"><span class="keyword">import</span> User <span class="keyword">from</span> <span class="string">'./models/user'</span>;</span><br><span class="line"><span class="keyword">import</span> Recipe <span class="keyword">from</span> <span class="string">'./models/recipe'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼•å…¥ webpackDevMiddleware å½“åšå‰ç«¯ server middleware</span></span><br><span class="line"><span class="comment">/* Client Packages */</span></span><br><span class="line"><span class="keyword">import</span> webpack <span class="keyword">from</span> <span class="string">'webpack'</span>;</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> webpackDevMiddleware <span class="keyword">from</span> <span class="string">'webpack-dev-middleware'</span>;</span><br><span class="line"><span class="keyword">import</span> webpackHotMiddleware <span class="keyword">from</span> <span class="string">'webpack-hot-middleware'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; RouterContext, match &#125; <span class="keyword">from</span> <span class="string">'react-router'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; renderToString &#125; <span class="keyword">from</span> <span class="string">'react-dom/server'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> Immutable, &#123; fromJS &#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</span><br><span class="line"><span class="comment">/* Common Packages */</span></span><br><span class="line"><span class="keyword">import</span> webpackConfig <span class="keyword">from</span> <span class="string">'../../webpack.config'</span>;</span><br><span class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">'../common/routes'</span>;</span><br><span class="line"><span class="keyword">import</span> configureStore <span class="keyword">from</span> <span class="string">'../common/store/configureStore'</span>;</span><br><span class="line"><span class="keyword">import</span> fetchComponentData <span class="keyword">from</span> <span class="string">'../common/utils/fetchComponentData'</span>;</span><br><span class="line"><span class="keyword">import</span> apiRoutes <span class="keyword">from</span> <span class="string">'./controllers/api.js'</span>;</span><br><span class="line"><span class="comment">/* config */</span></span><br><span class="line"><span class="comment">// åˆå§‹åŒ– Express server</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Express();</span><br><span class="line"><span class="keyword">const</span> port = process.env.PORT || <span class="number">3000</span>;</span><br><span class="line"><span class="comment">// è¿æ¥åˆ°èµ„æ–™åº“ï¼Œç›¸å…³è®¾å®šæ¡£æ¡ˆæ”¾åœ¨ config.database</span></span><br><span class="line">mongoose.connect(config.database); <span class="comment">// connect to database</span></span><br><span class="line">app.set(<span class="string">'env'</span>, <span class="string">'production'</span>);</span><br><span class="line"><span class="comment">// è®¾å®šé™æ€æ¡£æ¡ˆä½ç½®</span></span><br><span class="line">app.use(<span class="string">'/static'</span>, Express.static(__dirname + <span class="string">'/public'</span>));</span><br><span class="line">app.use(cookieParser());</span><br><span class="line"><span class="comment">// use body parser so we can get info from POST and/or URL parameters</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;)); <span class="comment">// only can deal with key/value</span></span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line"><span class="comment">// use morgan to log requests to the console</span></span><br><span class="line">app.use(morgan(<span class="string">'dev'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// è´Ÿè´£æ¯æ¬¡æ¥å—åˆ° request çš„å¤„ç†å‡½æ•°ï¼Œåˆ¤æ–­è¯¥å¦‚ä½•å¤„ç†å’Œå–å¾— initialState æ•´ç†åç»“åˆä¼ºæœå™¨æ¸²æŸ“é¡µé¢ä¼ å¾€å‰ç«¯</span></span><br><span class="line"><span class="keyword">const</span> handleRender = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Query our mock API asynchronously</span></span><br><span class="line">  match(&#123; routes, <span class="attr">location</span>: req.url &#125;, (error, redirectLocation, renderProps) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      res.status(<span class="number">500</span>).send(error.message);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (redirectLocation) &#123;</span><br><span class="line">      res.redirect(<span class="number">302</span>, redirectLocation.pathname + redirectLocation.search);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (renderProps == <span class="literal">null</span>) &#123;</span><br><span class="line">      res.status(<span class="number">404</span>).send(<span class="string">'Not found'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    fetchComponentData(req.cookies.token).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> isAuthorized = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">if</span> (response[<span class="number">1</span>].data.success === <span class="literal">true</span>) &#123;</span><br><span class="line">         isAuthorized = <span class="literal">true</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        isAuthorized = <span class="literal">false</span>;        </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> initialState = fromJS(&#123;</span><br><span class="line">        recipe: &#123;</span><br><span class="line">          recipes: response[<span class="number">0</span>].data,</span><br><span class="line">          recipe: &#123;</span><br><span class="line">            id: <span class="string">''</span>,</span><br><span class="line">            name: <span class="string">''</span>, </span><br><span class="line">            description: <span class="string">''</span>, </span><br><span class="line">            imagePath: <span class="string">''</span>,            </span><br><span class="line">          &#125;  </span><br><span class="line">        &#125;,</span><br><span class="line">        user: &#123;</span><br><span class="line">          isAuthorized: isAuthorized,</span><br><span class="line">          isEdit: <span class="literal">false</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// server side æ¸²æŸ“é¡µé¢</span></span><br><span class="line">      <span class="comment">// Create a new Redux store instance</span></span><br><span class="line">      <span class="keyword">const</span> store = configureStore(initialState);</span><br><span class="line">      <span class="keyword">const</span> initView = renderToString(</span><br><span class="line">        &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">          &lt;RouterContext &#123;...renderProps&#125; /&gt;</span><br><span class="line">        &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">      );</span></span><br><span class="line"><span class="regexp">      let state = store.getState();</span></span><br><span class="line"><span class="regexp">      let page = renderFullPage(initView, state);</span></span><br><span class="line"><span class="regexp">      return res.status(200).send(page);</span></span><br><span class="line"><span class="regexp">    &#125;)</span></span><br><span class="line"><span class="regexp">    .catch(err =&gt; res.end(err.message));</span></span><br><span class="line"><span class="regexp">  &#125;)</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ åŸºç¡€é¡µé¢ HTML è®¾è®¡</span></span><br><span class="line"><span class="regexp">const renderFullPage = (html, preloadedState) =&gt; (`</span></span><br><span class="line"><span class="regexp">    &lt;!doctype html&gt;</span></span><br><span class="line"><span class="regexp">    &lt;html&gt;</span></span><br><span class="line"><span class="regexp">      &lt;head&gt;</span></span><br><span class="line"><span class="regexp">        &lt;title&gt;OpenCook åˆ†äº«æ–™ç†çš„ç¾å¥½æ—¶å…‰&lt;/</span>title&gt;</span><br><span class="line">        &lt;!-- Latest compiled and minified CSS --&gt;</span><br><span class="line">        &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"//maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap.min.css"</span>&gt;</span><br><span class="line">        &lt;!-- Optional theme --&gt;</span><br><span class="line">        &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"//maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap-theme.min.css"</span>&gt;</span><br><span class="line">        &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"//maxcdn.bootstrapcdn.com/bootswatch/3.3.7/journal/bootstrap.min.css"</span>&gt;</span><br><span class="line">      &lt;body&gt;</span><br><span class="line">        &lt;div id=<span class="string">"app"</span>&gt;$&#123;html&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;script&gt;</span></span><br><span class="line"><span class="regexp">          window.__PRELOADED_STATE__ = $&#123;JSON.stringify(preloadedState).replace(/</span>&lt;<span class="regexp">/g, '\\x3c')&#125;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>script&gt;</span><br><span class="line">        &lt;script src=<span class="string">"/static/bundle.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>body&gt;</span><br><span class="line">    &lt;<span class="regexp">/html&gt;`</span></span><br><span class="line"><span class="regexp">);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ è®¾å®š hot reload middleware</span></span><br><span class="line"><span class="regexp">const compiler = webpack(webpackConfig);</span></span><br><span class="line"><span class="regexp">app.use(webpackDevMiddleware(compiler, &#123; noInfo: true, publicPath: webpackConfig.output.publicPath &#125;));</span></span><br><span class="line"><span class="regexp">app.use(webpackHotMiddleware(compiler));</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ è®¾è®¡ API prefixï¼Œå¹¶ä½¿ç”¨ controller ä¸­çš„ apiRoutes è¿›è¡Œå¤„ç†</span></span><br><span class="line"><span class="regexp">app.use('/</span>api<span class="string">', apiRoutes);  </span></span><br><span class="line"><span class="string">// ä½¿ç”¨ä¼ºæœå™¨ç«¯ handleRender </span></span><br><span class="line"><span class="string">app.use(handleRender);</span></span><br><span class="line"><span class="string">app.listen(port, (error) =&gt; &#123;</span></span><br><span class="line"><span class="string">  if (error) &#123;</span></span><br><span class="line"><span class="string">    console.error(error)</span></span><br><span class="line"><span class="string">  &#125; else &#123;</span></span><br><span class="line"><span class="string">    console.info(`==&gt; ğŸŒ  Listening on port $&#123;port&#125;. Open up http://localhost:$&#123;port&#125;/ in your browser.`)</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;);</span></span><br></pre></td></tr></table></figure>
<p>ç”±äº Node ç«¯è¦åˆ°æ–°ç‰ˆå¯¹äº ES6 æ”¯æ´è¾ƒå¥½ï¼Œæ‰€ä»¥å…ˆç”¨ <code>babel-register</code> åœ¨ <code>src/server/index.js</code> å»å³æ—¶è½¬è¯‘ <code>server.js</code>ï¼Œä½†ç›®å‰ä¸å»ºè®®åœ¨ <code>production</code> ç¯å¢ƒä½¿ç”¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// use babel-register to precompile ES6 syntax</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'babel-register'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./server'</span>);</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨æˆ‘ä»¬æ¥è®¾è®¡ä¸€ä¸‹æˆ‘ä»¬èµ„æ–™åº“çš„ Schemaï¼Œåœ¨è¿™è¾¹æˆ‘ä»¬ä½¿ç”¨ MongoDB çš„ ORM Mongooseï¼Œå¯ä»¥æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨ç‰©ä»¶æ–¹å¼è¿›è¡Œèµ„æ–™åº“çš„æ“ä½œï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ mongoose å’Œ Schema</span></span><br><span class="line"><span class="keyword">import</span> mongoose, &#123; Schema &#125; <span class="keyword">from</span> <span class="string">'mongoose'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ mongoose.model å»ºç«‹æ–°çš„èµ„æ–™è¡¨ï¼Œå¹¶å°† Schema ä¼ å…¥</span></span><br><span class="line"><span class="comment">// è¿™è¾¹æˆ‘ä»¬è®¾è®¡äº†é£Ÿè°±åˆ†äº«çš„ä¸€äº›åŸºæœ¬è¦ç´ ï¼ŒåŒ…æ‹¬åç§°ã€æè¿°ã€ç…§ç‰‡ä½ç½®ç­‰</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> mongoose.model(<span class="string">'Recipe'</span>, <span class="keyword">new</span> Schema(&#123; </span><br><span class="line">    id: <span class="built_in">String</span>,</span><br><span class="line">    name: <span class="built_in">String</span>, </span><br><span class="line">    description: <span class="built_in">String</span>, </span><br><span class="line">    imagePath: <span class="built_in">String</span>,</span><br><span class="line">    steps: <span class="built_in">Array</span>,</span><br><span class="line">    updatedAt: <span class="built_in">Date</span>,</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥ mongoose å’Œ Schema</span></span><br><span class="line"><span class="keyword">import</span> mongoose, &#123; Schema &#125; <span class="keyword">from</span> <span class="string">'mongoose'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ mongoose.model å»ºç«‹æ–°çš„èµ„æ–™è¡¨ï¼Œå¹¶å°† Schema ä¼ å…¥</span></span><br><span class="line"><span class="comment">// è¿™è¾¹æˆ‘ä»¬è®¾è®¡äº†ä½¿ç”¨è€…çš„ä¸€äº›åŸºæœ¬è¦ç´ ï¼ŒåŒ…æ‹¬åç§°ã€æè¿°ã€ç…§ç‰‡ä½ç½®ç­‰</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> mongoose.model(<span class="string">'User'</span>, <span class="keyword">new</span> Schema(&#123; </span><br><span class="line">    id: <span class="built_in">Number</span>,</span><br><span class="line">    username: <span class="built_in">String</span>, </span><br><span class="line">    email: <span class="built_in">String</span>,</span><br><span class="line">    password: <span class="built_in">String</span>, </span><br><span class="line">    admin: <span class="built_in">Boolean</span> </span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†æ–¹ä¾¿ç»´æŠ¤ï¼Œæˆ‘ä»¬æŠŠ API çš„éƒ¨ä»½ç»Ÿä¸€åœ¨ <code>src/server/controllers/api.js</code> è¿›è¡Œç®¡ç†ï¼Œè¿™éƒ¨ä»½ä¼šæ¶‰åŠæ¯”è¾ƒå¤š Node å’Œ mongoose çš„æ“ä½œï¼Œè‹¥è¯»è€…å°šä¸ç†Ÿæ‚‰å¯ä»¥å‚è€ƒ <a href="http://mongoosejs.com/" target="_blank" rel="noopener">mongoose å®˜ç½‘</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Express <span class="keyword">from</span> <span class="string">'express'</span>;</span><br><span class="line"><span class="comment">// å¼•å…¥ jsonwebtoken å¥—ä»¶ </span></span><br><span class="line"><span class="keyword">import</span> jwt <span class="keyword">from</span> <span class="string">'jsonwebtoken'</span>;</span><br><span class="line"><span class="comment">// å¼•å…¥ Userã€Recipe Model æ–¹ä¾¿è¿›è¡Œèµ„æ–™åº“æ“ä½œ</span></span><br><span class="line"><span class="keyword">import</span> User <span class="keyword">from</span> <span class="string">'../models/user'</span>;</span><br><span class="line"><span class="keyword">import</span> Recipe <span class="keyword">from</span> <span class="string">'../models/recipe'</span>;</span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">'../config'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// API Route</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Express();</span><br><span class="line"><span class="keyword">const</span> apiRoutes = Express.Router();</span><br><span class="line"><span class="comment">// è®¾å®š JSON Web Token çš„ secret variable</span></span><br><span class="line">app.set(<span class="string">'superSecret'</span>, config.secret); <span class="comment">// secret variable</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨è€…ç™»å…¥ API ï¼Œä¾æ®ä½¿ç”¨ email å’Œ å¯†ç å»éªŒè¯ï¼Œè‹¥æˆåŠŸåˆ™å›ä¼ ä¸€ä¸ªè®¤è¯ tokenï¼ˆæ—¶æ•ˆ24å°æ—¶ï¼‰æˆ‘ä»¬æŠŠå®ƒå­˜åœ¨ cookie ä¸­ï¼Œæ–¹ä¾¿å‰åç«¯å­˜å–ã€‚è¿™è¾¹æˆ‘ä»¬å…ˆä¸è€ƒè™‘å¤ªå¤šèµ„è®¯å®‰å…¨çš„è®®é¢˜</span></span><br><span class="line">apiRoutes.post(<span class="string">'/login'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// find the user</span></span><br><span class="line">  User.findOne(&#123;</span><br><span class="line">    email: req.body.email</span><br><span class="line">  &#125;, (err, user) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      res.json(&#123; <span class="attr">success</span>: <span class="literal">false</span>, <span class="attr">message</span>: <span class="string">'Authentication failed. User not found.'</span> &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (user) &#123;</span><br><span class="line">      <span class="comment">// check if password matches</span></span><br><span class="line">      <span class="keyword">if</span> (user.password != req.body.password) &#123;</span><br><span class="line">        res.json(&#123; <span class="attr">success</span>: <span class="literal">false</span>, <span class="attr">message</span>: <span class="string">'Authentication failed. Wrong password.'</span> &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// if user is found and password is right</span></span><br><span class="line">        <span class="comment">// create a token</span></span><br><span class="line">        <span class="keyword">const</span> token = jwt.sign(&#123; <span class="attr">email</span>: user.email &#125;, app.get(<span class="string">'superSecret'</span>), &#123;</span><br><span class="line">          expiresIn: <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> <span class="comment">// expires in 24 hours</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// return the information including token as JSON</span></span><br><span class="line">        <span class="comment">// è‹¥ç™»å…¥æˆåŠŸå›ä¼ ä¸€ä¸ª json è®¯æ¯</span></span><br><span class="line">        res.json(&#123;</span><br><span class="line">          success: <span class="literal">true</span>,</span><br><span class="line">          message: <span class="string">'Enjoy your token!'</span>,</span><br><span class="line">          token: token,</span><br><span class="line">          userId: user._id</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;   </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// åˆå§‹åŒ– apiï¼Œä¸€å¼€å§‹èµ„æ–™åº“å°šæœªå»ºç«‹ä»»ä½•ä½¿ç”¨è€…ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æµè§ˆå™¨è¾“å…¥ `http://localhost:3000/api/setup`ï¼Œè¿›è¡Œèµ„æ–™åº“åˆå§‹åŒ–ã€‚è¿™ä¸ªåŠ¨ä½œå°†æ–°å¢ä¸€ä¸ªä½¿ç”¨è€…ã€ä¸€ä»½é£Ÿè°±ï¼Œè‹¥æ˜¯æˆåŠŸæ–°å¢å°†å›ä¼ ä¸€ä¸ª success è®¯æ¯</span></span><br><span class="line">apiRoutes.get(<span class="string">'/setup'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="comment">// create a sample user</span></span><br><span class="line">  <span class="keyword">const</span> sampleUser = <span class="keyword">new</span> User(&#123; </span><br><span class="line">    username: <span class="string">'mark'</span>, </span><br><span class="line">    email: <span class="string">'mark@demo.com'</span>, </span><br><span class="line">    password: <span class="string">'123456'</span>,</span><br><span class="line">    admin: <span class="literal">true</span> </span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> sampleRecipe = <span class="keyword">new</span> Recipe(&#123;</span><br><span class="line">    id: <span class="string">'110ec58a-a0f2-4ac4-8393-c866d813b8d1'</span>,</span><br><span class="line">    name: <span class="string">'ç•ªèŒ„ç‚’è›‹'</span>, </span><br><span class="line">    description: <span class="string">'ç•ªèŒ„ç‚’è›‹ï¼Œä¸€é“éå¸¸ç»å…¸çš„å®¶å¸¸èœæ–™ç†ã€‚è™½ç„¶çœ‹ä¼¼æ™®é€šï¼Œä½†æ¯ä¸ªå®¶åº­éƒ½æœ‰å±äºè‡ªå·±å®¶è£¡çš„ä¸åŒå‘³é“'</span>, </span><br><span class="line">    imagePath: <span class="string">'https://c1.staticflickr.com/6/5011/5510599760_6668df5a8a_z.jpg'</span>,</span><br><span class="line">    steps: [<span class="string">'æ”¾å…¥ç•ªèŒ„'</span>, <span class="string">'æ‰“ä¸ªè›‹'</span>, <span class="string">'æ”¾å…¥å°‘è®¸ç›å·´'</span>, <span class="string">'ç”¨å¿ƒå¿«ç‚’'</span>],</span><br><span class="line">    updatedAt: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// save the sample user</span></span><br><span class="line">  sampleUser.save(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    sampleRecipe.save(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'User saved successfully'</span>);</span><br><span class="line">      res.json(&#123; <span class="attr">success</span>: <span class="literal">true</span> &#125;);      </span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// å›ä¼ æ‰€æœ‰ recipes</span></span><br><span class="line">apiRoutes.get(<span class="string">'/recipes'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  Recipe.find(&#123;&#125;, (err, recipes) =&gt; &#123;</span><br><span class="line">    res.status(<span class="number">200</span>).json(recipes);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// route middleware to verify a token</span></span><br><span class="line"><span class="comment">// æ¥ä¸‹æ¥çš„ api å°†è¿›è¡Œæ§ç®¡ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»åœ¨ç½‘å€è¯·æ±‚ä¸­å¤¹å¸¦è®¤è¯ token æ‰èƒ½å®Œæˆè¯·æ±‚</span></span><br><span class="line">apiRoutes.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// check header or url parameters or post parameters for token</span></span><br><span class="line">  <span class="comment">// ç¡®è®¤æ ‡å¤´ã€ç½‘å€æˆ– post å‚æ•°æ˜¯å¦å«æœ‰ tokenï¼Œæœ¬èŒƒä¾‹å› ä¸ºç®€ä¾¿ä½¿ç”¨ç½‘å€ query å‚æ•° </span></span><br><span class="line">  <span class="keyword">var</span> token = req.body.token || req.query.token || req.headers[<span class="string">'x-access-token'</span>];</span><br><span class="line">  <span class="comment">// decode token</span></span><br><span class="line">  <span class="keyword">if</span> (token) &#123;</span><br><span class="line">    <span class="comment">// verifies secret and checks exp</span></span><br><span class="line">    jwt.verify(token, app.get(<span class="string">'superSecret'</span>), (err, decoded) =&gt; &#123;      </span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.json(&#123; <span class="attr">success</span>: <span class="literal">false</span>, <span class="attr">message</span>: <span class="string">'Failed to authenticate token.'</span> &#125;);    </span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// if everything is good, save to request for use in other routes</span></span><br><span class="line">        req.decoded = decoded;    </span><br><span class="line">        next();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// if there is no token</span></span><br><span class="line">    <span class="comment">// return an error</span></span><br><span class="line">    <span class="keyword">return</span> res.status(<span class="number">403</span>).send(&#123; </span><br><span class="line">        success: <span class="literal">false</span>, </span><br><span class="line">        message: <span class="string">'No token provided.'</span> </span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// ç¡®è®¤è®¤è¯æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">apiRoutes.get(<span class="string">'/authenticate'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  res.json(&#123;</span><br><span class="line">    success: <span class="literal">true</span>,</span><br><span class="line">    message: <span class="string">'Enjoy your token!'</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// create recipe æ–°å¢é£Ÿè°±</span></span><br><span class="line">apiRoutes.post(<span class="string">'/recipes'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> newRecipe = <span class="keyword">new</span> Recipe(&#123;</span><br><span class="line">    name: req.body.name, </span><br><span class="line">    description: req.body.description, </span><br><span class="line">    imagePath: req.body.imagePath,</span><br><span class="line">    steps: [<span class="string">'æ”¾å…¥ç•ªèŒ„'</span>, <span class="string">'æ‰“ä¸ªè›‹'</span>, <span class="string">'æ”¾å…¥å°‘è®¸ç›å·´'</span>, <span class="string">'ç”¨å¿ƒå¿«ç‚’'</span>],</span><br><span class="line">    updatedAt: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">  &#125;);</span><br><span class="line">  newRecipe.save(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'User saved successfully'</span>);</span><br><span class="line">    res.json(&#123; <span class="attr">success</span>: <span class="literal">true</span> &#125;);      </span><br><span class="line">  &#125;);</span><br><span class="line">&#125;); </span><br><span class="line"><span class="comment">// update recipe æ ¹æ® _idï¼ˆmongodb çš„ idï¼‰æ›´æ–°é£Ÿè°±</span></span><br><span class="line">apiRoutes.put(<span class="string">'/recipes/:id'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  Recipe.update(&#123; <span class="attr">_id</span>: req.params.id &#125;, &#123;</span><br><span class="line">    name: req.body.name, </span><br><span class="line">    description: req.body.description, </span><br><span class="line">    imagePath: req.body.imagePath,</span><br><span class="line">    steps: [<span class="string">'æ”¾å…¥ç•ªèŒ„'</span>, <span class="string">'æ‰“ä¸ªè›‹'</span>, <span class="string">'æ”¾å…¥å°‘è®¸ç›å·´'</span>, <span class="string">'ç”¨å¿ƒå¿«ç‚’'</span>],</span><br><span class="line">    updatedAt: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">  &#125; ,(err) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'User updated successfully'</span>);</span><br><span class="line">    res.json(&#123; <span class="attr">success</span>: <span class="literal">true</span> &#125;);      </span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// remove recipe æ ¹æ® _id åˆ é™¤é£Ÿè°±ï¼Œè‹¥æˆåŠŸå›ä¼ æˆåŠŸè®¯æ¯</span></span><br><span class="line">apiRoutes.delete(<span class="string">'/recipes/:id'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  Recipe.remove(&#123; <span class="attr">_id</span>: req.params.id &#125;, (err, recipe) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'remove saved successfully'</span>);</span><br><span class="line">    res.json(&#123; <span class="attr">success</span>: <span class="literal">true</span> &#125;); </span><br><span class="line">  &#125;);</span><br><span class="line">&#125;); </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> apiRoutes;</span><br></pre></td></tr></table></figure>
<p>è®¾å®šæ•´ä¸ª App çš„ routingï¼Œæˆ‘ä»¬ä¸»è¦é¡µé¢æœ‰ <code>HomePageContainer</code>ã€<code>LoginPageContainer</code>ã€<code>SharePageContainer</code>ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯æˆ‘ä»¬è¿™è¾¹ä½¿ç”¨ <a href="http://www.darul.io/post/2016-01-05_react-higher-order-components" target="_blank" rel="noopener">Higher Order Components</a> ï¼ˆHigher Order Components ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œ æ¥æ”¶ä¸€ä¸ª Component ååœ¨ Class Component çš„ render ä¸­ return å›ä¼ å…¥çš„ componentsï¼‰æ–¹å¼å»ç¡®è®¤ä½¿ç”¨è€…æ˜¯å¦æœ‰ç™»å…¥ï¼Œè‹¥æœ‰æ²¡ç™»å…¥åˆ™ä¸èƒ½è¿›å…¥åˆ†äº«é£Ÿè°±é¡µé¢ï¼Œåä¹‹è‹¥å·²ç™»å…¥ä¹Ÿä¸ä¼šå†è¿›åˆ°ç™»å…¥é¡µé¢ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Route, IndexRoute &#125; <span class="keyword">from</span> <span class="string">'react-router'</span>;</span><br><span class="line"><span class="keyword">import</span> Main <span class="keyword">from</span> <span class="string">'../components/Main'</span>;</span><br><span class="line"><span class="keyword">import</span> CheckAuth <span class="keyword">from</span> <span class="string">'../components/CheckAuth'</span>;</span><br><span class="line"><span class="keyword">import</span> HomePageContainer <span class="keyword">from</span> <span class="string">'../containers/HomePageContainer'</span>;</span><br><span class="line"><span class="keyword">import</span> LoginPageContainer <span class="keyword">from</span> <span class="string">'../containers/LoginPageContainer'</span>;</span><br><span class="line"><span class="keyword">import</span> SharePageContainer <span class="keyword">from</span> <span class="string">'../containers/SharePageContainer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (</span><br><span class="line">  &lt;Route path=<span class="string">'/'</span> component=&#123;Main&#125;&gt;</span><br><span class="line">    &lt;IndexRoute component=&#123;HomePageContainer&#125; /&gt;</span><br><span class="line">    &lt;Route path=<span class="string">"/login"</span> component=&#123;CheckAuth(LoginPageContainer, <span class="string">'guest'</span>)&#125;/&gt;</span><br><span class="line">    &lt;Route path=<span class="string">"/share"</span> component=&#123;CheckAuth(SharePageContainer, <span class="string">'auth'</span>)&#125;/&gt;</span><br><span class="line">  &lt;<span class="regexp">/Route&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>
<p>è®¾å®šè¡Œä¸ºå¸¸æ•°ï¼ˆ<code>src/constants/actionTypes.js</code>ï¼‰ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> AUTH_START    = <span class="string">"AUTH_START"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> AUTH_COMPLETE = <span class="string">"AUTH_COMPLETE"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> AUTH_ERROR    = <span class="string">"AUTH_ERROR"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> START_LOGOUT    = <span class="string">"START_LOGOUT"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CHECK_AUTH    = <span class="string">"CHECK_AUTH"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SET_USER    = <span class="string">"SET_USER"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SHOW_SPINNER    = <span class="string">"SHOW_SPINNER"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HIDE_SPINNER    = <span class="string">"HIDE_SPINNER"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SET_UI    = <span class="string">"SET_UI"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> GET_RECIPES = <span class="string">'GET_RECIPES'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SET_RECIPE = <span class="string">'SET_RECIPE'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_RECIPE = <span class="string">'ADD_RECIPE'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> UPDATE_RECIPE = <span class="string">'UPDATE_RECIPE'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> DELETE_RECIPE = <span class="string">'DELETE_RECIPE'</span>;</span><br></pre></td></tr></table></figure>
<p>è®¾å®š <code>src/actions/recipeActions.js</code>ï¼Œæˆ‘ä»¬è¿™è¾¹ä½¿ç”¨ redux-promiseï¼Œå¯ä»¥å¾ˆå®¹æ˜“ä½¿ç”¨éåŒæ­¥çš„è¡Œä¸º WebAPIï¼š  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createAction &#125; <span class="keyword">from</span> <span class="string">'redux-actions'</span>;</span><br><span class="line"><span class="keyword">import</span> WebAPI <span class="keyword">from</span> <span class="string">'../utils/WebAPI'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  GET_RECIPES,</span><br><span class="line">  ADD_RECIPE,</span><br><span class="line">  UPDATE_RECIPE,</span><br><span class="line">  DELETE_RECIPE,</span><br><span class="line">  SET_RECIPE,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'../constants/actionTypes'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getRecipes = createAction(<span class="string">'GET_RECIPES'</span>, WebAPI.getRecipes);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addRecipe = createAction(<span class="string">'ADD_RECIPE'</span>, WebAPI.addRecipe);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> updateRecipe = createAction(<span class="string">'UPDATE_RECIPE'</span>, WebAPI.updateRecipe);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> deleteRecipe = createAction(<span class="string">'DELETE_RECIPE'</span>, WebAPI.deleteRecipe);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> setRecipe = createAction(<span class="string">'SET_RECIPE'</span>);</span><br></pre></td></tr></table></figure>
<p>è®¾å®š <code>src/actions/uiActions.js</code>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createAction &#125; <span class="keyword">from</span> <span class="string">'redux-actions'</span>;</span><br><span class="line"><span class="keyword">import</span> WebAPI <span class="keyword">from</span> <span class="string">'../utils/WebAPI'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  SHOW_SPINNER,</span><br><span class="line">  HIDE_SPINNER,</span><br><span class="line">  SET_UI,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'../constants/actionTypes'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> showSpinner = createAction(<span class="string">'SHOW_SPINNER'</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> hideSpinner = createAction(<span class="string">'HIDE_SPINNER'</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> setUi = createAction(<span class="string">'SET_UI'</span>);</span><br></pre></td></tr></table></figure>
<p>è®¾å®š <code>src/actions/userActions.js</code>ï¼Œå¤„ç†ä½¿ç”¨è€…ç™»å…¥ç™»å‡ºç­‰è¡Œä¸ºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createAction &#125; <span class="keyword">from</span> <span class="string">'redux-actions'</span>;</span><br><span class="line"><span class="keyword">import</span> WebAPI <span class="keyword">from</span> <span class="string">'../utils/WebAPI'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  AUTH_START,</span><br><span class="line">  AUTH_COMPLETE,</span><br><span class="line">  AUTH_ERROR,</span><br><span class="line">  START_LOGOUT,</span><br><span class="line">  CHECK_AUTH,</span><br><span class="line">  SET_USER</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'../constants/actionTypes'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> authStart = createAction(<span class="string">'AUTH_START'</span>, WebAPI.login);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> authComplete = createAction(<span class="string">'AUTH_COMPLETE'</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> authError = createAction(<span class="string">'AUTH_ERROR'</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> startLogout = createAction(<span class="string">'START_LOGOUT'</span>, WebAPI.logout);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> checkAuth = createAction(<span class="string">'CHECK_AUTH'</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> setUser = createAction(<span class="string">'SET_USER'</span>);</span><br></pre></td></tr></table></figure>
<p>äº <code>scr/actions/index.js</code> è¾“å‡º actionsï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">'./userActions'</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">'./recipeActions'</span>;</span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">'./uiActions'</span>;</span><br></pre></td></tr></table></figure>
<p>äº <code>scr/common/utils/fetchComponentData.js</code> è®¾å®š server side åˆå§‹ fetchComponentDataï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™è¾¹ä½¿ç”¨ axios æ–¹ä¾¿è¿›è¡Œ promises base request</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"><span class="comment">// è®°å¾—é™„åŠ ä¸Šæˆ‘ä»¬å­˜åœ¨ cookies çš„ token  </span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchComponentData</span>(<span class="params">token = <span class="string">'token'</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> promises = [axios.get(<span class="string">'http://localhost:3000/api/recipes'</span>), axios.get(<span class="string">'http://localhost:3000/api/authenticate?token='</span> + token)];</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.all(promises);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>äº <code>scr/common/utils/WebAPI.js</code> æ‰€æœ‰å‰ç«¯ API çš„å¤„ç†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; browserHistory &#125; <span class="keyword">from</span> <span class="string">'react-router'</span>;</span><br><span class="line"><span class="comment">// å¼•å…¥ uuid å½“åšé£Ÿè°± id</span></span><br><span class="line"><span class="keyword">import</span> uuid <span class="keyword">from</span> <span class="string">'uuid'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; </span><br><span class="line">  authComplete,</span><br><span class="line">  authError,</span><br><span class="line">  hideSpinner,</span><br><span class="line">  completeLogout,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'../actions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getCookie å‡½æ•°ä¼ å…¥ key å›ä¼  value</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">keyName</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = keyName + <span class="string">'='</span>;</span><br><span class="line">  <span class="keyword">const</span> cookies = <span class="built_in">document</span>.cookie.split(<span class="string">';'</span>);</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; cookies.length; i++) &#123;</span><br><span class="line">      <span class="keyword">let</span> cookie = cookies[i];</span><br><span class="line">      <span class="keyword">while</span> (cookie.charAt(<span class="number">0</span>)==<span class="string">' '</span>) &#123;</span><br><span class="line">          cookie = cookie.substring(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (cookie.indexOf(name) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> cookie.substring(name.length, cookie.length);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// å‘¼å«åç«¯ç™»å…¥ api</span></span><br><span class="line">  login: <span class="function">(<span class="params">dispatch, email, password</span>) =&gt;</span> &#123;</span><br><span class="line">    axios.post(<span class="string">'/api/login'</span>, &#123;</span><br><span class="line">      email: email,</span><br><span class="line">      password: password</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(response.data.success === <span class="literal">false</span>) &#123;</span><br><span class="line">        dispatch(authError()); </span><br><span class="line">        dispatch(hideSpinner());  </span><br><span class="line">        alert(<span class="string">'å‘ç”Ÿé”™è¯¯ï¼Œè¯·å†è¯•ä¸€æ¬¡ï¼'</span>);</span><br><span class="line">        <span class="built_in">window</span>.location.reload();        </span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">document</span>.cookie.token) &#123;</span><br><span class="line">          <span class="keyword">let</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">          d.setTime(d.getTime() + (<span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>));</span><br><span class="line">          <span class="keyword">const</span> expires = <span class="string">'expires='</span> + d.toUTCString();</span><br><span class="line">          <span class="built_in">document</span>.cookie = <span class="string">'token='</span> + response.data.token + <span class="string">'; '</span> + expires;</span><br><span class="line">          dispatch(authComplete());</span><br><span class="line">          dispatch(hideSpinner());  </span><br><span class="line">          browserHistory.push(<span class="string">'/'</span>); </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">      dispatch(authError());</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// å‘¼å«åç«¯ç™»å‡º api  </span></span><br><span class="line">  logout: <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.cookie = <span class="string">'token=; '</span> + <span class="string">'expires=Thu, 01 Jan 1970 00:00:01 GMT;'</span>;</span><br><span class="line">    dispatch(hideSpinner());  </span><br><span class="line">    browserHistory.push(<span class="string">'/'</span>); </span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ç¡®è®¤ä½¿ç”¨è€…æ˜¯å¦ç™»å…¥    </span></span><br><span class="line">  checkAuth: <span class="function">(<span class="params">dispatch, token</span>) =&gt;</span> &#123;</span><br><span class="line">    axios.post(<span class="string">'/api/authenticate'</span>, &#123;</span><br><span class="line">      token: token,</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(response.data.success === <span class="literal">false</span>) &#123;</span><br><span class="line">        dispatch(authError()); </span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        dispatch(authComplete());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">      dispatch(authError());</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// å–å¾—ç›®å‰æ‰€æœ‰é£Ÿè°±    </span></span><br><span class="line">  getRecipes: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    axios.get(<span class="string">'/api/recipes'</span>)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// å‘¼å«æ–°å¢é£Ÿè°± apiï¼Œè®°å¾—é™„åŠ ä¸Šæˆ‘ä»¬å­˜åœ¨ cookies çš„ token  </span></span><br><span class="line">  addRecipe: <span class="function">(<span class="params">dispatch, name, description, imagePath</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = uuid.v4();</span><br><span class="line">    axios.post(<span class="string">'/api/recipes?token='</span> + getCookie(<span class="string">'token'</span>), &#123;</span><br><span class="line">      id: id,</span><br><span class="line">      name: name,</span><br><span class="line">      description: description,</span><br><span class="line">      imagePath: imagePath,</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(response.data.success === <span class="literal">false</span>) &#123;</span><br><span class="line">        dispatch(hideSpinner());  </span><br><span class="line">        alert(<span class="string">'å‘ç”Ÿé”™è¯¯ï¼Œè¯·å†è¯•ä¸€æ¬¡ï¼'</span>);</span><br><span class="line">        browserHistory.push(<span class="string">'/share'</span>);         </span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        dispatch(hideSpinner());  </span><br><span class="line">        <span class="built_in">window</span>.location.reload();        </span><br><span class="line">        browserHistory.push(<span class="string">'/'</span>); </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// å‘¼å«æ›´æ–°é£Ÿè°± apiï¼Œè®°å¾—é™„åŠ ä¸Šæˆ‘ä»¬å­˜åœ¨ cookies çš„ token  </span></span><br><span class="line">  updateRecipe: <span class="function">(<span class="params">dispatch, recipeId, name, description, imagePath</span>) =&gt;</span> &#123;</span><br><span class="line">    axios.put(<span class="string">'/api/recipes/'</span> + recipeId + <span class="string">'?token='</span> + getCookie(<span class="string">'token'</span>), &#123;</span><br><span class="line">      id: recipeId,</span><br><span class="line">      name: name,</span><br><span class="line">      description: description,</span><br><span class="line">      imagePath: imagePath,</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(response.data.success === <span class="literal">false</span>) &#123;</span><br><span class="line">        dispatch(hideSpinner());  </span><br><span class="line">        dispatch(setRecipe(&#123; <span class="attr">key</span>: <span class="string">'recipeId'</span>, <span class="attr">value</span>: <span class="string">''</span> &#125;));</span><br><span class="line">        dispatch(setUi(&#123; <span class="attr">key</span>: <span class="string">'isEdit'</span>, <span class="attr">value</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">        alert(<span class="string">'å‘ç”Ÿé”™è¯¯ï¼Œè¯·å†è¯•ä¸€æ¬¡ï¼'</span>);</span><br><span class="line">        browserHistory.push(<span class="string">'/share'</span>);         </span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        dispatch(hideSpinner());  </span><br><span class="line">        <span class="built_in">window</span>.location.reload();        </span><br><span class="line">        browserHistory.push(<span class="string">'/'</span>); </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// å‘¼å«åˆ é™¤é£Ÿè°± apiï¼Œè®°å¾—é™„åŠ ä¸Šæˆ‘ä»¬å­˜åœ¨ cookies çš„ token  </span></span><br><span class="line">  deleteRecipe: <span class="function">(<span class="params">dispatch, recipeId</span>) =&gt;</span> &#123;</span><br><span class="line">    axios.delete(<span class="string">'/api/recipes/'</span> + recipeId + <span class="string">'?token='</span> + getCookie(<span class="string">'token'</span>))</span><br><span class="line">    .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(response.data.success === <span class="literal">false</span>) &#123;</span><br><span class="line">        dispatch(hideSpinner());  </span><br><span class="line">        alert(<span class="string">'å‘ç”Ÿé”™è¯¯ï¼Œè¯·å†è¯•ä¸€æ¬¡ï¼'</span>);</span><br><span class="line">        browserHistory.push(<span class="string">'/'</span>);         </span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        dispatch(hideSpinner());  </span><br><span class="line">        <span class="built_in">window</span>.location.reload();        </span><br><span class="line">        browserHistory.push(<span class="string">'/'</span>); </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    &#125;);    </span><br><span class="line">  &#125; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥è®¾å®šæˆ‘ä»¬çš„ <code>reducers</code>ï¼Œä»¥ä¸‹æ˜¯ <code>src/common/reducers/data/recipeReducers.js</code>ï¼Œ<code>GET_RECIPES</code> è´Ÿè´£å°†åç«¯ API å–å¾—çš„æ‰€æœ‰é£Ÿè°±å­˜æ”¾åœ¨ recipes ä¸­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; handleActions &#125; <span class="keyword">from</span> <span class="string">'redux-actions'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; RecipeState &#125; <span class="keyword">from</span> <span class="string">'../../constants/models'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  GET_RECIPES,</span><br><span class="line">  SET_RECIPE,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'../../constants/actionTypes'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> recipeReducers = handleActions(&#123;</span><br><span class="line">  GET_RECIPES: <span class="function">(<span class="params">state, &#123; payload &#125;</span>) =&gt;</span> (</span><br><span class="line">    state.set(</span><br><span class="line">      <span class="string">'recipes'</span>,</span><br><span class="line">      payload.recipes</span><br><span class="line">    )</span><br><span class="line">  ),</span><br><span class="line">  SET_RECIPE: <span class="function">(<span class="params">state, &#123; payload &#125;</span>) =&gt;</span> (</span><br><span class="line">    state.setIn(payload.keyPath, payload.value)</span><br><span class="line">  ),  </span><br><span class="line">&#125;, RecipeState);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> recipeReducers;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸‹æ˜¯ <code>src/common/reducers/data/userReducers.js</code>ï¼Œè´Ÿè´£ç¡®è®¤ç™»å…¥ç›¸å…³å¤„ç†äº‹é¡¹ã€‚æ³¨æ„çš„æ˜¯ç”±äºç™»å…¥æ˜¯éåŒæ­¥æ‰§è¡Œï¼Œæ‰€ä»¥ä¼šæœ‰å‡ ä¸ªé˜¶æ®µçš„è¡Œä¸ºè¦åšå¤„ç†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; handleActions &#125; <span class="keyword">from</span> <span class="string">'redux-actions'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UserState &#125; <span class="keyword">from</span> <span class="string">'../../constants/models'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  AUTH_START,</span><br><span class="line">  AUTH_COMPLETE,</span><br><span class="line">  AUTH_ERROR,</span><br><span class="line">  LOGOUT_START,</span><br><span class="line">  SET_USER,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'../../constants/actionTypes'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userReducers = handleActions(&#123;</span><br><span class="line">  AUTH_START: <span class="function">(<span class="params">state</span>) =&gt;</span> (</span><br><span class="line">    state.merge(&#123;</span><br><span class="line">      isAuthorized: <span class="literal">false</span>,      </span><br><span class="line">    &#125;)</span><br><span class="line">  ),  </span><br><span class="line">  AUTH_COMPLETE: <span class="function">(<span class="params">state</span>) =&gt;</span> (</span><br><span class="line">    state.merge(&#123;</span><br><span class="line">      email: <span class="string">''</span>,</span><br><span class="line">      password: <span class="string">''</span>,</span><br><span class="line">      isAuthorized: <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  ),  </span><br><span class="line">  AUTH_ERROR: <span class="function">(<span class="params">state</span>) =&gt;</span> (</span><br><span class="line">    state.merge(&#123;</span><br><span class="line">      username: <span class="string">''</span>,</span><br><span class="line">      email: <span class="string">''</span>,</span><br><span class="line">      password: <span class="string">''</span>,</span><br><span class="line">      isAuthorized: <span class="literal">false</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  ),  </span><br><span class="line">  START_LOGOUT: <span class="function">(<span class="params">state</span>) =&gt;</span> (</span><br><span class="line">    state.merge(&#123;</span><br><span class="line">      isAuthorized: <span class="literal">false</span>,      </span><br><span class="line">    &#125;)</span><br><span class="line">  ), </span><br><span class="line">  CHECK_AUTH: <span class="function">(<span class="params">state</span>) =&gt;</span> (</span><br><span class="line">    state.set(<span class="string">'isAuthorized'</span>, <span class="literal">true</span>)</span><br><span class="line">  ),</span><br><span class="line">  SET_USER: <span class="function">(<span class="params">state, &#123; payload &#125;</span>) =&gt;</span> (</span><br><span class="line">    state.set(payload.key, payload.value)</span><br><span class="line">  ),</span><br><span class="line">&#125;, UserState);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> userReducers;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸‹æ˜¯ <code>src/common/reducers/ui/uiReducers.js</code>ï¼Œè´Ÿè´£ç¡®è®¤ UI State ç›¸å…³å¤„ç†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; handleActions &#125; <span class="keyword">from</span> <span class="string">'redux-actions'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UiState &#125; <span class="keyword">from</span> <span class="string">'../../constants/models'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  SHOW_SPINNER,</span><br><span class="line">  HIDE_SPINNER,</span><br><span class="line">  SET_UI,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'../../constants/actionTypes'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> uiReducers = handleActions(&#123;</span><br><span class="line">  SHOW_SPINNER: <span class="function">(<span class="params">state</span>) =&gt;</span> (</span><br><span class="line">    state.set(</span><br><span class="line">      <span class="string">'spinnerVisible'</span>,</span><br><span class="line">      <span class="literal">true</span></span><br><span class="line">    )</span><br><span class="line">  ),</span><br><span class="line">  HIDE_SPINNER: <span class="function">(<span class="params">state</span>) =&gt;</span> (</span><br><span class="line">    state.set(</span><br><span class="line">      <span class="string">'spinnerVisible'</span>,</span><br><span class="line">      <span class="literal">false</span></span><br><span class="line">    )</span><br><span class="line">  ),</span><br><span class="line">  SET_UI: <span class="function">(<span class="params">state, &#123; payload &#125;</span>) =&gt;</span> (</span><br><span class="line">    state.set(payload.key, payload.value)</span><br><span class="line">  ),    </span><br><span class="line">&#125;, UiState);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> uiReducers;</span><br></pre></td></tr></table></figure>
<p>æœ€åæŠŠæ‰€æœ‰ recipes åœ¨ <code>src/common/reducers/index.js</code> ä½¿ç”¨ <code>combineReducers</code> æ•´åˆåœ¨ä¸€èµ·ï¼Œæ³¨æ„çš„æ˜¯æˆ‘ä»¬æ•´ä¸ª App çš„èµ„æ–™æµè¦ç»´æŒ immutableï¼š </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux-immutable'</span>;</span><br><span class="line"><span class="keyword">import</span> ui <span class="keyword">from</span> <span class="string">'./ui/uiReducers'</span>;</span><br><span class="line"><span class="keyword">import</span> recipe <span class="keyword">from</span> <span class="string">'./data/recipeReducers'</span>;</span><br><span class="line"><span class="keyword">import</span> user <span class="keyword">from</span> <span class="string">'./data/userReducers'</span>;</span><br><span class="line"><span class="comment">// import routes from './routes';</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootReducer = combineReducers(&#123;</span><br><span class="line">  ui,</span><br><span class="line">  recipe,</span><br><span class="line">  user,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸‹æ˜¯ <code>src/common/store/configureStore.js</code> å¤„ç† store çš„å»ºç«‹ï¼Œè¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨äº† <code>promiseMiddleware</code> çš„ middlewareï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> promiseMiddleware <span class="keyword">from</span> <span class="string">'redux-promise'</span>;</span><br><span class="line"><span class="keyword">import</span> createLogger <span class="keyword">from</span> <span class="string">'redux-logger'</span>;</span><br><span class="line"><span class="keyword">import</span> Immutable <span class="keyword">from</span> <span class="string">'immutable'</span>;</span><br><span class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">'../reducers'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = Immutable.Map();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">configureStore</span>(<span class="params">preloadedState = initialState</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> store = createStore(</span><br><span class="line">    rootReducer,</span><br><span class="line">    preloadedState,</span><br><span class="line">    applyMiddleware(createLogger(&#123; <span class="attr">stateTransformer</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.toJS() &#125;, promiseMiddleware))</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> store;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»è¿‡ä¸€è¿ä¸²åŠªåŠ›ï¼Œæˆ‘ä»¬æ¥åˆ°äº† View çš„ä½ˆå»ºã€‚åœ¨è¿™ä¸ª App ä¸­æˆ‘ä»¬ä¸»è¦ä¼šç”±ä¸€ä¸ª AppBar è´Ÿè´£æ‰€æœ‰é¡µé¢çš„å¯¼è§ˆï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªé¡µé¢éƒ½ä¼šæœ‰ AppBar å¸¸é©»åœ¨ä¸Šé¢ï¼Œç„¶è€Œä¸Šé¢çš„å†…å®¹åˆ™ä¼šä¾ UI State ä¸­çš„ isAuthorized è€Œæœ‰æ‰€ä¸åŒã€‚æœ€åè¦ç•™æ„çš„æ˜¯æˆ‘ä»¬ä½¿ç”¨äº† React Bootstrapt æ¥å»ºç«‹ React Componentã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; LinkContainer &#125; <span class="keyword">from</span> <span class="string">'react-router-bootstrap'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">'react-router'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Navbar, Nav, NavItem, NavDropdown, MenuItem &#125; <span class="keyword">from</span> <span class="string">'react-bootstrap'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AppBar = (&#123;</span><br><span class="line">  isAuthorized,</span><br><span class="line">  onToShare,</span><br><span class="line">  onLogout,</span><br><span class="line">&#125;) =&gt; (</span><br><span class="line">  &lt;Navbar&gt;</span><br><span class="line">    &lt;Navbar.Header&gt;</span><br><span class="line">      &lt;Navbar.Brand&gt;</span><br><span class="line">        &lt;Link to=<span class="string">"/"</span>&gt;OpenCook&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Navbar.Brand&gt;</span><br><span class="line">      &lt;Navbar.Toggle /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Navbar.Header&gt;</span></span><br><span class="line"><span class="regexp">    &lt;Navbar.Collapse&gt;</span></span><br><span class="line"><span class="regexp">      &#123;</span></span><br><span class="line"><span class="regexp">        isAuthorized === false ?</span></span><br><span class="line"><span class="regexp">        (</span></span><br><span class="line"><span class="regexp">          &lt;Nav pullRight&gt;</span></span><br><span class="line"><span class="regexp">            &lt;LinkContainer to=&#123;&#123; pathname: '/</span>login<span class="string">' &#125;&#125;&gt;&lt;NavItem eventKey=&#123;2&#125; href="#"&gt;ç™»å…¥&lt;/NavItem&gt;&lt;/LinkContainer&gt;</span></span><br><span class="line"><span class="string">          &lt;/Nav&gt;</span></span><br><span class="line"><span class="string">        ) :</span></span><br><span class="line"><span class="string">        (</span></span><br><span class="line"><span class="string">          &lt;Nav pullRight&gt;</span></span><br><span class="line"><span class="string">            &lt;NavItem eventKey=&#123;1&#125; onClick=&#123;onToShare&#125;&gt;åˆ†äº«é£Ÿè°±&lt;/NavItem&gt;</span></span><br><span class="line"><span class="string">            &lt;NavItem eventKey=&#123;2&#125; onClick=&#123;onLogout&#125; href="#"&gt;ç™»å‡º&lt;/NavItem&gt;</span></span><br><span class="line"><span class="string">          &lt;/Nav&gt;</span></span><br><span class="line"><span class="string">        )        </span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &lt;/Navbar.Collapse&gt;</span></span><br><span class="line"><span class="string">  &lt;/Navbar&gt;</span></span><br><span class="line"><span class="string">);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default AppBar;</span></span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸‹æ˜¯ <code>src/common/containers/AppBarContainer/AppBarContainer.js</code>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> AppBar <span class="keyword">from</span> <span class="string">'../../components/AppBar'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; browserHistory &#125; <span class="keyword">from</span> <span class="string">'react-router'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  startLogout,</span><br><span class="line">  setRecipe,</span><br><span class="line">  setUi,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'../../actions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</span><br><span class="line">  (state) =&gt; (&#123;</span><br><span class="line">    isAuthorized: state.getIn([<span class="string">'user'</span>, <span class="string">'isAuthorized'</span>]),</span><br><span class="line">  &#125;),</span><br><span class="line">  (dispatch) =&gt; (&#123;</span><br><span class="line">    onToShare: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      dispatch(setRecipe(&#123; <span class="attr">key</span>: <span class="string">'recipeId'</span>, <span class="attr">value</span>: <span class="string">''</span> &#125;));</span><br><span class="line">      dispatch(setUi(&#123; <span class="attr">key</span>: <span class="string">'isEdit'</span>, <span class="attr">value</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">      <span class="built_in">window</span>.location.reload();        </span><br><span class="line">      browserHistory.push(<span class="string">'/share'</span>); </span><br><span class="line">    &#125;,</span><br><span class="line">    onLogout: <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">      dispatch(startLogout(dispatch))</span><br><span class="line">    ),</span><br><span class="line">  &#125;)</span><br><span class="line">)(AppBar);</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸‹æ˜¯ <code>src/components/Main/Main.js</code>ï¼Œé€è¿‡ route æœºåˆ¶è®© AppBarContainer å¯ä»¥æˆä¸ºæ•´ä¸ª App æ¯æ¨¡ç‰ˆï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> AppBarContainer <span class="keyword">from</span> <span class="string">'../../containers/AppBarContainer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Main = <span class="function">(<span class="params">props</span>) =&gt;</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;AppBarContainer /&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Main;</span><br></pre></td></tr></table></figure>
<p> åœ¨ <code>checkAuth</code> è¿™ä¸ª Component ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ°äº† Higher Order Components çš„è§‚å¿µã€‚Higher Order Components ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œ æ¥æ”¶ä¸€ä¸ª Component ååœ¨ Class Component çš„ render ä¸­ return å›ä¼ å…¥çš„ components æ–¹å¼å»ç¡®è®¤ä½¿ç”¨è€…æ˜¯å¦æœ‰ç™»å…¥ï¼Œè‹¥æœ‰æ²¡ç™»å…¥åˆ™ä¸èƒ½è¿›å…¥åˆ†äº«é£Ÿè°±é¡µé¢ï¼Œåä¹‹è‹¥å·²ç™»å…¥ä¹Ÿä¸ä¼šå†è¿›åˆ°ç™»å…¥é¡µé¢ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">'react-router'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// High Order Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">requireAuthentication</span>(<span class="params">Component, type</span>) </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">AuthenticatedComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    componentWillMount() &#123;</span><br><span class="line">      <span class="keyword">this</span>.checkAuth();</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">      <span class="keyword">this</span>.checkAuth();</span><br><span class="line">    &#125;</span><br><span class="line">    checkAuth() &#123;</span><br><span class="line">      <span class="keyword">if</span>(type === <span class="string">'auth'</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.props.isAuthorized) &#123;</span><br><span class="line">          <span class="keyword">this</span>.props.router.push(<span class="string">'/'</span>);</span><br><span class="line">        &#125;        </span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.props.isAuthorized) &#123;</span><br><span class="line">          <span class="keyword">this</span>.props.router.push(<span class="string">'/'</span>);</span><br><span class="line">        &#125;                </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> ( </span><br><span class="line">        &lt;div&gt; </span><br><span class="line">        &#123;</span><br><span class="line">          (type === <span class="string">'auth'</span>) ?</span><br><span class="line">          <span class="keyword">this</span>.props.isAuthorized === <span class="literal">true</span> ? &lt;Component &#123;...this.props &#125; /&gt; : <span class="literal">null</span></span><br><span class="line">          : <span class="keyword">this</span>.props.isAuthorized === <span class="literal">false</span> ? &lt;Component &#123;...this.props &#125; /&gt; : <span class="literal">null</span></span><br><span class="line">        &#125; </span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">  const mapStateToProps = (state) =&gt; (&#123;</span></span><br><span class="line"><span class="regexp">    isAuthorized: state.getIn(['user', 'isAuthorized']),</span></span><br><span class="line"><span class="regexp">  &#125;);</span></span><br><span class="line"><span class="regexp">  return connect(mapStateToProps)(withRouter(AuthenticatedComponent));</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†æ¯ä¸ªé£Ÿè°±å‘ˆç°è®¾è®¡æˆ RecipeBoxï¼Œä»¥ä¸‹æ˜¯åœ¨ <code>src/common/components/HomePage/HomePage.js</code> ä½¿ç”¨ map æ–¹æ³•å»è¿­ä»£æˆ‘ä»¬çš„é£Ÿè°±ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> RecipeBoxContainer <span class="keyword">from</span> <span class="string">'../../containers/RecipeBoxContainer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> HomePage = (&#123;</span><br><span class="line">  recipes</span><br><span class="line">&#125;) =&gt; (</span><br><span class="line">  &lt;div&gt;        </span><br><span class="line">  &#123;</span><br><span class="line">    recipes.map(<span class="function">(<span class="params">recipe, index</span>) =&gt;</span> (</span><br><span class="line">      &lt;RecipeBoxContainer recipe=&#123;recipe&#125; key=&#123;index&#125;  /&gt;</span><br><span class="line">    )).toJS()</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default HomePage;</span></span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸‹æ˜¯ <code>src/common/containers/HomePageContainer/HomePageContainer.js</code>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> HomePage <span class="keyword">from</span> <span class="string">'../../components/HomePage'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</span><br><span class="line">  (state) =&gt; (&#123;</span><br><span class="line">    recipes: state.getIn([<span class="string">'recipe'</span>, <span class="string">'recipes'</span>]),    </span><br><span class="line">  &#125;),</span><br><span class="line">  (dispatch) =&gt; (&#123;</span><br><span class="line">  &#125;)</span><br><span class="line">)(HomePage);</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>src/common/components/LoginBox/LoginBox.js</code> è®¾è®¡æˆ‘ä»¬ LoginBoxï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Form, FormGroup, Button, FormControl, ControlLabel &#125; <span class="keyword">from</span> <span class="string">'react-bootstrap'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> LoginBox = (&#123;</span><br><span class="line">  email,</span><br><span class="line">  password,</span><br><span class="line">  onChangeEmailInput,</span><br><span class="line">  onChangePasswordInput,</span><br><span class="line">  onLoginSubmit</span><br><span class="line">&#125;) =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Form horizontal&gt;</span><br><span class="line">      &lt;FormGroup</span><br><span class="line">        controlId=<span class="string">"formBasicText"</span></span><br><span class="line">      &gt;</span><br><span class="line">        &lt;ControlLabel&gt;è¯·è¾“å…¥æ‚¨çš„ Email&lt;<span class="regexp">/ControlLabel&gt;</span></span><br><span class="line"><span class="regexp">        &lt;FormControl</span></span><br><span class="line"><span class="regexp">          type="text"</span></span><br><span class="line"><span class="regexp">          onChange=&#123;onChangeEmailInput&#125;</span></span><br><span class="line"><span class="regexp">          placeholder="Enter Email"</span></span><br><span class="line"><span class="regexp">        /</span>&gt;</span><br><span class="line">        &lt;FormControl.Feedback /&gt;</span><br><span class="line">      &lt;<span class="regexp">/FormGroup&gt;</span></span><br><span class="line"><span class="regexp">      &lt;FormGroup</span></span><br><span class="line"><span class="regexp">        controlId="formBasicText"</span></span><br><span class="line"><span class="regexp">      &gt;</span></span><br><span class="line"><span class="regexp">        &lt;ControlLabel&gt;è¯·è¾“å…¥æ‚¨çš„å¯†ç &lt;/</span>ControlLabel&gt;</span><br><span class="line">        &lt;FormControl</span><br><span class="line">          type=<span class="string">"password"</span></span><br><span class="line">          onChange=&#123;onChangePasswordInput&#125;</span><br><span class="line">          placeholder=<span class="string">"Enter Password"</span></span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;FormControl.Feedback /&gt;</span><br><span class="line">      &lt;<span class="regexp">/FormGroup&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Button </span></span><br><span class="line"><span class="regexp">        onClick=&#123;onLoginSubmit&#125; </span></span><br><span class="line"><span class="regexp">        bsStyle="success" </span></span><br><span class="line"><span class="regexp">        bsSize="large" </span></span><br><span class="line"><span class="regexp">        block</span></span><br><span class="line"><span class="regexp">      &gt;</span></span><br><span class="line"><span class="regexp">        æäº¤é€å‡º</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Button&gt;</span><br><span class="line">    &lt;<span class="regexp">/Form&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> LoginBox;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸‹æ˜¯ <code>src/common/containers/LoginBoxContainer/LoginBoxContainer.js</code>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> LoginBox <span class="keyword">from</span> <span class="string">'../../components/LoginBox'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; </span><br><span class="line">  authStart,</span><br><span class="line">  showSpinner,</span><br><span class="line">  setUser,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'../../actions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</span><br><span class="line">  (state) =&gt; (&#123;</span><br><span class="line">    email: state.getIn([<span class="string">'user'</span>, <span class="string">'email'</span>]),</span><br><span class="line">    password: state.getIn([<span class="string">'user'</span>, <span class="string">'password'</span>]),</span><br><span class="line">  &#125;),</span><br><span class="line">  (dispatch) =&gt; (&#123;</span><br><span class="line">    onChangeEmailInput: <span class="function">(<span class="params">event</span>) =&gt;</span> (</span><br><span class="line">      dispatch(setUser(&#123; <span class="attr">key</span>: <span class="string">'email'</span>, <span class="attr">value</span>: event.target.value &#125;))</span><br><span class="line">    ),</span><br><span class="line">    onChangePasswordInput: <span class="function">(<span class="params">event</span>) =&gt;</span> (</span><br><span class="line">      dispatch(setUser(&#123; <span class="attr">key</span>: <span class="string">'password'</span>, <span class="attr">value</span>: event.target.value &#125;))</span><br><span class="line">    ),</span><br><span class="line">    onLoginSubmit: <span class="function">(<span class="params">email, password</span>) =&gt;</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      dispatch(authStart(dispatch, email, password));</span><br><span class="line">      dispatch(showSpinner());</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;),</span><br><span class="line">  (stateProps, dispatchProps, ownProps) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; email, password &#125; = stateProps;</span><br><span class="line">    <span class="keyword">const</span> &#123; onLoginSubmit &#125; = dispatchProps;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, stateProps, dispatchProps, ownProps, &#123;</span><br><span class="line">      onLoginSubmit: onLoginSubmit(email, password),</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">)(LoginBox);</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>src/common/components/LoginPage/LoginPage.js</code>ï¼Œå½“ spinnerVisible ä¸º true ä¼šæ˜¾ç¤º spinnerï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Grid, Row, Col, Image &#125; <span class="keyword">from</span> <span class="string">'react-bootstrap'</span>;</span><br><span class="line"><span class="keyword">import</span> LoginBoxContainer <span class="keyword">from</span> <span class="string">'../../containers/LoginBoxContainer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> LoginPage = (&#123;</span><br><span class="line">  spinnerVisible,</span><br><span class="line">&#125;) =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Row className=<span class="string">"show-grid"</span>&gt;</span><br><span class="line">      &lt;Col xs=&#123;<span class="number">6</span>&#125; xsOffset=&#123;<span class="number">3</span>&#125;&gt;</span><br><span class="line">        &lt;LoginBoxContainer /&gt;</span><br><span class="line">        &#123; spinnerVisible === <span class="literal">true</span> ?</span><br><span class="line">          &lt;Image src=<span class="string">"/static/images/loading.gif"</span> /&gt; :</span><br><span class="line">          <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">      &lt;<span class="regexp">/Col&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Row&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default LoginPage;</span></span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸‹æ˜¯ <code>src/common/containers/LoginPageContainer/LoginPageContainer.js</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &#123; connect &#125; from &apos;react-redux&apos;;</span><br><span class="line">import LoginPage from &apos;../../components/LoginPage&apos;;</span><br><span class="line"></span><br><span class="line">export default connect(</span><br><span class="line">  (state) =&gt; (&#123;</span><br><span class="line">    spinnerVisible: state.getIn([&apos;ui&apos;, &apos;spinnerVisible&apos;]),</span><br><span class="line">  &#125;),</span><br><span class="line">  (dispatch) =&gt; (&#123;</span><br><span class="line">  &#125;)</span><br><span class="line">)(LoginPage);</span><br></pre></td></tr></table></figure>
<p>çœŸæ­£è®¾è®¡æˆ‘ä»¬å†…éƒ¨çš„é£Ÿè°±ï¼Œ <code>src/common/components/RecipeBox</code>ï¼Œä½¿ç”¨è€…ç™»å…¥çš„è¯å¯ä»¥ä¿®æ”¹å’Œåˆ é™¤é£Ÿè°±ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Grid, Row, Col, Image, Thumbnail, Button &#125; <span class="keyword">from</span> <span class="string">'react-bootstrap'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> RecipeBox = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span>(</span><br><span class="line">      &lt;Col xs=&#123;<span class="number">6</span>&#125; md=&#123;<span class="number">4</span>&#125;&gt;</span><br><span class="line">        &lt;Thumbnail src=&#123;props.recipe.get(<span class="string">'imagePath'</span>)&#125; alt=<span class="string">"242x200"</span>&gt;</span><br><span class="line">          &lt;h3&gt;&#123;props.recipe.get(<span class="string">'name'</span>)&#125;&lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">          &lt;p&gt;&#123;props.recipe.get('description')&#125;&lt;/</span>p&gt;</span><br><span class="line">          &#123;</span><br><span class="line">            props.isAuthorized === <span class="literal">true</span> ? (</span><br><span class="line">            &lt;p&gt;</span><br><span class="line">              &lt;Button bsStyle=<span class="string">"primary"</span> onClick=&#123;props.onDeleteRecipe(props.recipe.get(<span class="string">'_id'</span>))&#125;&gt;åˆ é™¤&lt;<span class="regexp">/Button&gt;&amp;nbsp;</span></span><br><span class="line"><span class="regexp">              &lt;Button bsStyle="default" onClick=&#123;props.onUpadateRecipe(props.recipe.get('_id'))&#125;&gt;ä¿®æ”¹&lt;/</span>Button&gt;</span><br><span class="line">            &lt;<span class="regexp">/p&gt;)</span></span><br><span class="line"><span class="regexp">            : null            </span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Thumbnail&gt;</span><br><span class="line">      &lt;<span class="regexp">/Col&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default RecipeBox;</span></span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸‹æ˜¯ <code>src/common/containers/RecipeBoxContainer/RecipeBoxContainer.js</code>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> RecipeBox <span class="keyword">from</span> <span class="string">'../../components/RecipeBox'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; browserHistory &#125; <span class="keyword">from</span> <span class="string">'react-router'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  deleteRecipe,</span><br><span class="line">  setRecipe,</span><br><span class="line">  setUi</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'../../actions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</span><br><span class="line">  (state) =&gt; (&#123;</span><br><span class="line">    isAuthorized: state.getIn([<span class="string">'user'</span>, <span class="string">'isAuthorized'</span>]),</span><br><span class="line">    recipes: state.getIn([<span class="string">'recipe'</span>, <span class="string">'recipes'</span>]),</span><br><span class="line">  &#125;),</span><br><span class="line">  (dispatch) =&gt; (&#123;</span><br><span class="line">    onDeleteRecipe: <span class="function">(<span class="params">recipeId</span>) =&gt;</span> <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">      dispatch(deleteRecipe(dispatch, recipeId))</span><br><span class="line">    ),</span><br><span class="line">    onUpadateRecipe: <span class="function">(<span class="params">recipes</span>) =&gt;</span> <span class="function">(<span class="params">recipeId</span>) =&gt;</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> recipeIndex = recipes.findIndex(<span class="function">(<span class="params">_recipe</span>) =&gt;</span> (_recipe.get(<span class="string">'_id'</span>) === recipeId));</span><br><span class="line">      <span class="keyword">const</span> recipe = recipeIndex !== <span class="number">-1</span> ? recipes.get(recipeIndex) : <span class="literal">undefined</span>;</span><br><span class="line">      dispatch(setRecipe(&#123; <span class="attr">keyPath</span>: [<span class="string">'recipe'</span>], <span class="attr">value</span>: recipe &#125;));</span><br><span class="line">      dispatch(setRecipe(&#123; <span class="attr">keyPath</span>: [<span class="string">'recipe'</span>, <span class="string">'id'</span>], <span class="attr">value</span>: recipeId &#125;));</span><br><span class="line">      dispatch(setUi(&#123; <span class="attr">key</span>: <span class="string">'isEdit'</span>, <span class="attr">value</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">      browserHistory.push(<span class="string">'/share?recipeId='</span> + recipeId); </span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;),</span><br><span class="line">  (stateProps, dispatchProps, ownProps) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; recipes &#125; = stateProps; </span><br><span class="line">    <span class="keyword">const</span> &#123; onUpadateRecipe &#125; = dispatchProps; </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, stateProps, dispatchProps, ownProps, &#123;</span><br><span class="line">      onUpadateRecipe: onUpadateRecipe(recipes),</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">)(RecipeBox);</span><br></pre></td></tr></table></figure>
<p>è®¾è®¡æˆ‘ä»¬åˆ†äº«é£Ÿè°±é¡µé¢ï¼Œè¿™è¾¹æˆ‘ä»¬æŠŠç¼–è¾‘é£Ÿè°±å’Œæ–°å¢åˆ†äº«ä¸€èµ·å…±ç”¨äº†åŒä¸€ä¸ª componentsï¼Œå·®åˆ«åœ¨äºæˆ‘ä»¬ä¼šåˆ¤æ–­ UI State ä¸­çš„ <code>isEdit</code>ï¼Œ å†³å®šç›¸åº”å¤„ç†æ–¹å¼ã€‚åœ¨ä¸­ <code>src/common/components/ShareBox/ShareBox.js</code>ï¼Œå¯ä»¥è®©ä½¿ç”¨è€…ç™»å…¥çš„åä¿®æ”¹å’Œåˆ é™¤é£Ÿè°±ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Form, FormGroup, Button, FormControl, ControlLabel &#125; <span class="keyword">from</span> <span class="string">'react-bootstrap'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ShareBox = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">    &lt;Form horizontal&gt;</span><br><span class="line">      &lt;FormGroup</span><br><span class="line">        controlId="formBasicText"</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;ControlLabel&gt;è¯·è¾“å…¥é£Ÿè°±åç§°&lt;/ControlLabel&gt;</span><br><span class="line">        &lt;FormControl</span><br><span class="line">          type="text"</span><br><span class="line">          placeholder="Enter text"</span><br><span class="line">          defaultValue=&#123;props.name&#125;</span><br><span class="line">          onChange=&#123;props.onChangeNameInput&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;FormControl.Feedback /&gt;</span><br><span class="line">      &lt;/FormGroup&gt;</span><br><span class="line">      &lt;FormGroup</span><br><span class="line">        controlId="formBasicText"</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;ControlLabel&gt;è¯·è¾“å…¥é£Ÿè°±è¯´æ˜&lt;/ControlLabel&gt;</span><br><span class="line">        &lt;FormControl </span><br><span class="line">          componentClass="textarea" </span><br><span class="line">          placeholder="textarea" </span><br><span class="line">          defaultValue=&#123;props.description&#125;          </span><br><span class="line">          onChange=&#123;props.onChangeDescriptionInput&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;FormControl.Feedback /&gt;</span><br><span class="line">      &lt;/FormGroup&gt;</span><br><span class="line">      &lt;FormGroup</span><br><span class="line">        controlId="formBasicText"</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;ControlLabel&gt;è¯·è¾“å…¥é£Ÿè°±å›¾ç‰‡ç½‘å€&lt;/ControlLabel&gt;</span><br><span class="line">        &lt;FormControl</span><br><span class="line">          type="text"</span><br><span class="line">          placeholder="Enter text"</span><br><span class="line">          defaultValue=&#123;props.imagePath&#125;</span><br><span class="line">          onChange=&#123;props.onChangeImageUrl&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;FormControl.Feedback /&gt;</span><br><span class="line">      &lt;/FormGroup&gt;</span><br><span class="line">      &lt;Button </span><br><span class="line">        onClick=&#123;props.onRecipeSubmit&#125; </span><br><span class="line">        bsStyle="success" </span><br><span class="line">        bsSize="large" </span><br><span class="line">        block</span><br><span class="line">      &gt;</span><br><span class="line">        æäº¤é€å‡º</span><br><span class="line">      &lt;/Button&gt;</span><br><span class="line">    &lt;/Form&gt;</span><br><span class="line">  &lt;/div&gt;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ShareBox;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸‹æ˜¯ <code>src/common/containers/ShareBoxContainer/ShareBoxContainer.js</code>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> ShareBox <span class="keyword">from</span> <span class="string">'../../components/ShareBox'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; </span><br><span class="line">  addRecipe,</span><br><span class="line">  updateRecipe,</span><br><span class="line">  showSpinner,</span><br><span class="line">  setRecipe,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'../../actions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</span><br><span class="line">  (state) =&gt; (&#123;</span><br><span class="line">    recipes: state.getIn([<span class="string">'recipe'</span>, <span class="string">'recipes'</span>]),</span><br><span class="line">    recipeId: state.getIn([<span class="string">'recipe'</span>, <span class="string">'recipe'</span>, <span class="string">'id'</span>]),</span><br><span class="line">    name: state.getIn([<span class="string">'recipe'</span>, <span class="string">'recipe'</span>, <span class="string">'name'</span>]),</span><br><span class="line">    description: state.getIn([<span class="string">'recipe'</span>, <span class="string">'recipe'</span>, <span class="string">'description'</span>]),</span><br><span class="line">    imagePath: state.getIn([<span class="string">'recipe'</span>, <span class="string">'recipe'</span>, <span class="string">'imagePath'</span>]),</span><br><span class="line">    isEdit: state.getIn([<span class="string">'ui'</span>, <span class="string">'isEdit'</span>]),</span><br><span class="line">  &#125;),</span><br><span class="line">  (dispatch) =&gt; (&#123;</span><br><span class="line">    onChangeNameInput: <span class="function">(<span class="params">event</span>) =&gt;</span> (</span><br><span class="line">      dispatch(setRecipe(&#123; <span class="attr">keyPath</span>: [<span class="string">'recipe'</span>, <span class="string">'name'</span>], <span class="attr">value</span>: event.target.value &#125;))</span><br><span class="line">    ),</span><br><span class="line">    onChangeDescriptionInput: <span class="function">(<span class="params">event</span>) =&gt;</span> (</span><br><span class="line">      dispatch(setRecipe(&#123; <span class="attr">keyPath</span>: [<span class="string">'recipe'</span>, <span class="string">'description'</span>], <span class="attr">value</span>: event.target.value &#125;))</span><br><span class="line">    ),</span><br><span class="line">    onChangeImageUrl: <span class="function">(<span class="params">event</span>) =&gt;</span> (</span><br><span class="line">      dispatch(setRecipe(&#123; <span class="attr">keyPath</span>: [<span class="string">'recipe'</span>, <span class="string">'imagePath'</span>], <span class="attr">value</span>: event.target.value &#125;))</span><br><span class="line">    ),    </span><br><span class="line">    onRecipeSubmit: <span class="function">(<span class="params">recipes, recipeId, name, description, imagePath, isEdit</span>) =&gt;</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (isEdit === <span class="literal">true</span>) &#123;</span><br><span class="line">        dispatch(updateRecipe(dispatch, recipeId, name, description, imagePath));</span><br><span class="line">        dispatch(showSpinner());</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        dispatch(addRecipe(dispatch, name, description, imagePath));</span><br><span class="line">        dispatch(showSpinner());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,    </span><br><span class="line">  &#125;),</span><br><span class="line">  (stateProps, dispatchProps, ownProps) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; recipes, recipeId, name, description, imagePath, isEdit &#125; = stateProps;</span><br><span class="line">    <span class="keyword">const</span> &#123; onRecipeSubmit &#125; = dispatchProps;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, stateProps, dispatchProps, ownProps, &#123;</span><br><span class="line">      onRecipeSubmit: onRecipeSubmit(recipes, recipeId, name, description, imagePath, isEdit),</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;  </span><br><span class="line">)(ShareBox);</span><br></pre></td></tr></table></figure>
<p>å•çº¯çš„ SharePageï¼ˆ<code>src/common/components/SharePage/SharePage.js</code>ï¼‰é¡µé¢ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Grid, Row, Col &#125; <span class="keyword">from</span> <span class="string">'react-bootstrap'</span>;</span><br><span class="line"><span class="keyword">import</span> ShareBoxContainer <span class="keyword">from</span> <span class="string">'../../containers/ShareBoxContainer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SharePage = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Row className=<span class="string">"show-grid"</span>&gt;</span><br><span class="line">      &lt;Col xs=&#123;<span class="number">6</span>&#125; xsOffset=&#123;<span class="number">3</span>&#125;&gt;</span><br><span class="line">        &lt;ShareBoxContainer /&gt;</span><br><span class="line">      &lt;<span class="regexp">/Col&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Row&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default SharePage;</span></span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸‹æ˜¯ <code>src/common/containers/SharePageContainer/SharePageContainer.js</code>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> SharePage <span class="keyword">from</span> <span class="string">'../../components/SharePage'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</span><br><span class="line">  (state) =&gt; (&#123;</span><br><span class="line">  &#125;),</span><br><span class="line">  (dispatch) =&gt; (&#123;</span><br><span class="line">  &#125;)</span><br><span class="line">)(SharePage);</span><br></pre></td></tr></table></figure>
<p>æ­å–œä½ æˆåŠŸæŠµè¾¾ç»ˆç‚¹ï¼è‹¥ä¸€åˆ‡é¡ºåˆ©ï¼Œåœ¨ç»ˆç«¯æœºæ‰“ä¸Š <code>$ npm start</code>ï¼Œä½ å°†å¯ä»¥åœ¨æµè§ˆå™¨çš„ <code>http://localhost:3000</code> çœ‹åˆ°è‡ªå·±çš„æˆæœï¼</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬ç« æ•´åˆè¿‡å»æ‰€å­¦å’Œæ·»åŠ ä¸€äº›åç«¯èµ„æ–™åº“çŸ¥è¯†å¼€å‘äº†ä¸€ä¸ªå¯ä»¥ç™»å…¥ä¼šå‘˜å¹¶åˆ†äº«é£Ÿè°±çš„ç¤¾ç¾¤ç½‘ç«™ï¼å¿«æŠŠä½ çš„æˆæœå’Œä½ çš„æœ‹å‹åˆ†äº«å§ï¼è§‰å¾—æ„çŠ¹æœªå°½ï¼Ÿåˆ«å¿˜äº†é™„å½•ä¹Ÿå¾ˆç²¾é‡‡ï¼æœ€åï¼Œå†æ¬¡è°¢è°¢è¯»è€…ä»¬æ”¯æŒæˆ‘ä»¬ä¸€è·¯èµ°å®Œäº† React å¼€å‘å­¦ä¹ ä¹‹æ—…ï¼ç„¶è€Œå‰ç«¯æŠ€æœ¯å˜åŒ–å¾ˆå¿«ï¼Œå”¯æœ‰ä¸æ–­è‡ªæˆ‘å­¦ä¹ æ‰èƒ½æŒç»­æˆé•¿ã€‚ç¬”è€…æ‰ç–å­¦æµ…ï¼Œæ’°å†™å­¦ä¹ å¿ƒå¾—æˆ–æœ‰ç–æ¼ï¼Œè‹¥æœ‰ä»»ä½•å»ºè®®æˆ–æé†’éƒ½æ¬¢è¿å’Œæˆ‘è¯´ï¼Œå¤§å®¶ä¸€èµ·åŠ æ²¹ï¼šï¼‰</p>
<h2 id="å»¶ä¼¸é˜…è¯»"><a href="#å»¶ä¼¸é˜…è¯»" class="headerlink" title="å»¶ä¼¸é˜…è¯»"></a>å»¶ä¼¸é˜…è¯»</h2><ol>
<li><a href="https://github.com/joshgeller/react-redux-jwt-auth-example" target="_blank" rel="noopener">joshgeller/react-redux-jwt-auth-example</a></li>
<li><a href="https://medium.com/@rajaraodv/securing-react-redux-apps-with-jwt-tokens-fcfe81356ea0#.5hfri5j5m" target="_blank" rel="noopener">Securing React Redux Apps With JWT Tokens</a></li>
<li><a href="https://auth0.com/blog/adding-authentication-to-react-native-using-jwt/" target="_blank" rel="noopener">Adding Authentication to Your React Native App Using JSON Web Tokens</a></li>
<li><a href="http://vladimirponomarev.com/blog/authentication-in-react-apps-jwt" target="_blank" rel="noopener">Authentication in React Applications, Part 2: JSON Web Token (JWT)</a></li>
<li><a href="https://nodejust.com/nodejs-passport-auth-tutorial/" target="_blank" rel="noopener">Node.js èº«ä»½è®¤è¯ï¼šPassport å…¥é—¨</a></li>
<li><a href="https://github.com/reactjs/react-router/issues/83" target="_blank" rel="noopener">react-bootstrap compatibility #83</a></li>
<li><a href="https://github.com/reactjs/react-router/issues/725" target="_blank" rel="noopener">How to authenticate routes using Passport? #725</a></li>
<li><a href="https://github.com/tech-dojo/react-showcase" target="_blank" rel="noopener">Isomorphic React Web App Demo with Material UI</a></li>
<li><a href="https://github.com/reactjs/react-router/tree/master/examples/auth-flow" target="_blank" rel="noopener">react-router/examples/auth-flow/</a></li>
<li><a href="https://github.com/acdlite/redux-promise" target="_blank" rel="noopener">redux-promise</a></li>
<li><a href="http://qiita.com/takaki@github/items/42bddf01d36dc18bdc8e" target="_blank" rel="noopener">How to use redux-promise</a></li>
<li><a href="https://scotch.io/tutorials/authenticate-a-node-js-api-with-json-web-tokens" target="_blank" rel="noopener">Authenticate a Node.js API with JSON Web Tokens</a></li>
<li><a href="https://www.sitepoint.com/3-javascript-orms-you-might-not-know/" target="_blank" rel="noopener">3 JavaScript ORMs You Might Not Know</a></li>
<li><a href="https://github.com/lynndylanhurley/redux-auth" target="_blank" rel="noopener">lynndylanhurley/redux-auth</a></li>
<li><a href="http://stackoverflow.com/questions/33724396/how-to-avoid-getting-error-localstorage-is-not-defined-on-server-in-reactjs-is" target="_blank" rel="noopener">How to avoid getting error â€˜localStorage is not definedâ€™ on server in ReactJS isomorphic app?</a></li>
<li><a href="https://stormpath.com/blog/where-to-store-your-jwts-cookies-vs-html5-web-storage" target="_blank" rel="noopener">Where to Store your JWTs â€“ Cookies vs HTML5 Web Storage</a></li>
<li><a href="http://stackoverflow.com/questions/6922145/what-is-the-difference-between-server-side-cookie-and-client-side-cookie" target="_blank" rel="noopener">What is the difference between server side cookie and client side cookie? [closed]</a></li>
<li><a href="https://auth0.com/blog/angularjs-authentication-with-cookies-vs-token/" target="_blank" rel="noopener">Cookies vs Tokens. Getting auth right with Angular.JS</a></li>
<li><a href="https://auth0.com/blog/cookies-vs-tokens-definitive-guide/" target="_blank" rel="noopener">Cookies vs Tokens: The Definitive Guide</a></li>
<li><a href="https://github.com/joshgeller/react-redux-jwt-auth-example" target="_blank" rel="noopener">joshgeller/react-redux-jwt-auth-example</a></li>
<li><a href="http://stackoverflow.com/questions/31079081/programmatically-navigate-using-react-router" target="_blank" rel="noopener">Programmatically navigate using react router</a></li>
<li><a href="https://github.com/reactjs/react-router/blob/master/upgrade-guides/v2.4.0.md" target="_blank" rel="noopener">withRouter HoC (higher-order component) v2.4.0 Upgrade Guide</a></li>
</ol>
<h2 id="License"><a href="#License" class="headerlink" title="License"></a>License</h2><p>MIT, Special thanks <a href="http://loading.io/" target="_blank" rel="noopener">Loading.io</a></p>

                <div style="margin-top:15px;">
                   <hr class="nogutter">
                   <h3>^-^æ¬¢è¿å›å¤äº¤æµ^-^</h3>
                    <div id="comment" class='cloudcomment'></div>
                </div>
            </div>
            <div class="clearfix"></div>
            <hr class="nogutter">
            <div class="bshare-custom" style="float: right;margin-bottom: 10px">
                <div class="bsPromo bsPromo2"></div>
                <a title="åˆ†äº«åˆ°å¾®ä¿¡" class="bshare-weixin" href="javascript:void(0);"></a>
                <a title="åˆ†äº«åˆ°æ–°æµªå¾®åš" class="bshare-sinaminiblog" href="javascript:void(0);"></a>
                <a title="åˆ†äº«åˆ°QQç©ºé—´" class="bshare-qzone"></a>
                <a title="åˆ†äº«åˆ°äººäººç½‘" class="bshare-renren"></a>
                <a title="åˆ†äº«åˆ°è…¾è®¯å¾®åš" class="bshare-qqmb"></a>
                <a title="æ›´å¤šå¹³å°" class="bshare-more bshare-more-icon more-style-addthis"></a>
                <span class="BSHARE_COUNT bshare-share-count" style="float: none;">0</span></div>
            <div class="dashang">
                <div class="title">èµç‚¹å’–å•¡é’±^.^</div>
                <img src="/img/wchat.jpeg"/><img src="/img/zhifubao.png"/>
            </div>
            <div style="display: none;" id="rocket-to-top">
                <div style="opacity:0.3;display: block;" class="level-2"></div>
                <div class="level-3"></div>
            </div>
        </div>
        <nav class="pagination" role="pagination">
    
    <a class="pull-left" href="/kettle/kettle4.html" style="float: left;">
        â† kettleå®ç°å¼‚æ„æ•°æ®åŒæ­¥(å››)
    </a>
    
    
    <a class="pull-right" href="/nodejs/nodepost64file.html">
        nodeä¿å­˜base64ç¼–ç çš„å›¾ç‰‡ â†’
    </a>
    
</nav>

    </div>
</section>

<div id="qMenu" class="qmenu">
    <div class="sb-close" aria-label="Close Menu" aria-hidden="true" onclick="javacript:void(0);$('#qMenu').hide();">
        <img src="/img/close.png" alt="Close">
    </div>
</div>
<script type="text/javascript" charset="utf-8"
        src="http://static.bshare.cn/b/buttonLite.js#style=-1&amp;uuid=&amp;pophcol=2&amp;lang=zh"></script>
<script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/bshareC0.js"></script>
<script src="../../js/av-min.js"></script>
<script src="../../js/Valine.min.js"></script>
<script src=''></script>
<script type="text/javascript">
    //// å°ç«ç®­
    $(function () {
        var e = $("#rocket-to-top"),
                t = $(document).scrollTop(),
                n,
                r,
                i = !0;
        $(window).scroll(function () {
            var t = $(document).scrollTop();
            t == 0 ? e.css("background-position") == "0px 0px" ? e.fadeOut("slow") : i && (i = !1, $(".level-2").css("opacity", 1), e.delay(100).animate({
                        marginTop: "-1000px"
                    },
                    "normal",
                    function () {
                        e.css({
                            "margin-top": "-125px",
                            display: "none"
                        }),
                                i = !0
                    })) : e.fadeIn("slow")
        }),
                e.hover(function () {
                            $(".level-2").stop(!0).animate({
                                opacity: 1
                            })
                        },
                        function () {
                            $(".level-2").stop(!0).animate({
                                opacity: 0
                            })
                        }),
                $(".level-3").click(function () {
                    function t() {
                        var t = e.css("background-position");
                        if (e.css("display") == "none" || i == 0) {
                            clearInterval(n),
                                    e.css("background-position", "0px 0px");
                            return
                        }
                        switch (t) {
                            case "0px 0px":
                                e.css("background-position", "-298px 0px");
                                break;
                            case "-298px 0px":
                                e.css("background-position", "-447px 0px");
                                break;
                            case "-447px 0px":
                                e.css("background-position", "-596px 0px");
                                break;
                            case "-596px 0px":
                                e.css("background-position", "-745px 0px");
                                break;
                            case "-745px 0px":
                                e.css("background-position", "-298px 0px");
                        }
                    }

                    if (!i) return;
                    n = setInterval(t, 50),
                            $("html,body").animate({scrollTop: 0}, "slow");
                });
    });


    //// a æ ‡ç­¾æ–°é¡µé¢æ‰“å¼€
    $("#content a").each(function () {
        $(this).attr('target','_blank');
        $(this).attr('style','color:#203ada;');
    })

</script>
<script type="text/javascript">
    new Valine({
        el: '#comment' ,
        notify:false, 
        verify:false,   
        appId: 'Uxwf2V456s7ppITYyLu7dgLo-gzGzoHsz',
        appKey: 'Itbf11QmS5FNnX7UzEy72OQe',
        placeholder: 'just go go',
        path:window.location.pathname, 
        avatar:'mm' 
    });
    //// ç”Ÿæˆç›®å½•
    function go(title) {
        var top = $("#" + title).offset().top;
        $(document).scrollTop(top - 60);
    }
    ;
    var system = {
        win: false,
        mac: false,
        xll: false,
        ipad: false
    };
    //æ£€æµ‹å¹³å°
    var p = navigator.platform;
    system.win = p.indexOf("Win") == 0;
    system.mac = p.indexOf("Mac") == 0;
    system.x11 = (p == "X11") || (p.indexOf("Linux") == 0);
    system.ipad = (navigator.userAgent.match(/iPad/i) != null) ? true : false;
    if ((system.win || system.mac || system.xll || system.ipad)) {
        //document.writeln('PC')
        $(function () {
            var qMenu = '';
            var title = '';
            var obj;
            $('#content').find('h2').each(function (index, item) {
                obj = $(this).find('a.headerlink').eq(0);
                title = obj.attr('title');
                qMenu += '<div class="contenttitle" data="title" onclick="go(\'' + title + '\')">' + index + 'ã€' + title + '</div>';
            })
            if (qMenu.length > 0) {
                qMenu = ' <div><span>ç›®å½•</span>' + qMenu + '</div>';
                $('#qMenu').append($(qMenu));
            }else {
                $('#qMenu').remove();
            }
        });
    } else {
        $('#qMenu').remove();
    }
</script>

<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
        <div class="copy">
            <p>
                &copy; 2017
                <script>new Date().getFullYear() > 2010 && document.write("-" + new Date().getFullYear());</script>
                , Content By ustbtaotao. All Rights Reserved.
            </p>
            <p>welcome to U &nbsp;&nbsp;&nbsp;&nbsp;iå’–å•¡å°å±‹é‡Œçš„å’–å•¡è¢«å“å°<span style="color: red" id="totalcount">--</span>æ¬¡</p>
            <div class="guanzhu">
                <div class="weixin">
                    <span>å…³æ³¨å¾®ä¿¡</span>
                    <img src="/img/weixin.jpg"/>
                </div>
                <div class="weibo">
                    <span>å…³æ³¨å¾®åš</span>
                    <img src="/img/weibo.png"/>
                </div>
            </div>
        </div>
        <div class="social">
            <ul>
                
                
                
                
                
                <li><a href="http://weibo.com/ustbtaotao" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;
                </li>
                
            </ul>
        </div>
        <div class="clearfix"></div>
    </div>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?16ff0b4e8ca51c0734eb447a23473b9f";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?65e3e0b08038c3bdc07ecf223a4ae231";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

</footer>

<!-- ============================ END Footer =========================== -->
<!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
                window1 = $(window);
        hero.css({
            "height": window1.height() - 300
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/jquery.flexslider-min.js"></script><!-- Flexslider plugin -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<script src="/js/search.js"></script>
<script src="/js/jquery.fancybox-1.3.1.pack.js"></script>
<script type="text/javascript">
    $('#intro').find('img').each(function () {
        var alt = this.alt;

        if (alt) {
            $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
        }

        $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
    });
    jQuery(document).ready(function () {
        jQuery('.fancybox').fancybox();
    })
</script>

<!-- Initiate flexslider plugin -->
<script type="text/javascript">
    $(document).ready(function ($) {
        (function () {
            console.log('font');
            var getCss = function (path) {
                var head = document.getElementsByTagName('head')[0];
                link = document.createElement('link');
                link.href = path;
                link.rel = 'stylesheet';
                link.type = 'text/css';
                head.appendChild(link);
            };
            getCss('https://fonts.googleapis.com/css?family=Montserrat:400,700');
            getCss('https://fonts.googleapis.com/css?family=Open+Sans:400,600');
        })();
        $('.flexslider').flexslider({
            animation: "fade",
            prevText: "",
            nextText: "",
            directionNav: true
        });
    });
</script>


<script type="text/javascript">
    var search_path = "db.json";
    if (search_path.length == 0) {
        search_path = "search.xml";
    }
    var path = "/" + search_path;
    $("#local-search-input").keydown(function (event) {
        if (event.keyCode == "13") {//keyCode=13æ˜¯å›è½¦é”®
            searchFunc(path, 'local-search-input', 'local-search-result');
        }
    });
    $("#local-search-input").keyup(function (event) {
        searchFunc(path, 'local-search-input', 'local-search-result');
    });
    $("#navigation").click(function () {
        $("#local-search-result").html('');
        $("#local-search-result").hide();
        $("#local-search-input").val('');
    })
</script>


<!--ç»Ÿè®¡-->
<script src="//cdn1.lncld.net/static/js/2.5.0/av-min.js"></script>
<script>
    var APP_ID = 'Uxwf2V456s7ppITYyLu7dgLo-gzGzoHsz';
    var APP_KEY = 'Itbf11QmS5FNnX7UzEy72OQe';
    AV.init({
        appId: APP_ID,
        appKey: APP_KEY
    });
    function showTime(Counter) {
        var query = new AV.Query("Counter");
        if ($(".leancloud_visitors").length > 0) {
            var url = $(".leancloud_visitors").attr('id').trim();
            var postdate = $(".leancloud_visitors").attr('data_time').trim();
            var time = new Date(postdate).getTime();
            var init = 99;
            if (time + 7 * 24 * 3600 * 1000 > new Date().getTime()) {
                init = 1;
            }
            query.equalTo("words", url);
            query.count().then(function (number) {
                // There are number instances of MyClass.
                $(document.getElementById(url)).text(number && !isNaN(number) ? init + number : '--');
            }, function (error) {
                // error is an instance of AVError.
            });
        }
        query = new AV.Query("Counter");
        query.count().then(function (number) {
            // There are number instances of MyClass.
            $(document.getElementById('totalcount')).text(number && !isNaN(number) ? 2220 + number : '--');
        }, function (error) {
            // error is an instance of AVError.
        });
    }

    function addCount(Counter) {
        var url = $(".leancloud_visitors").length > 0 ? $(".leancloud_visitors").attr('id').trim() : 'icafebolger.com';
        var Counter = AV.Object.extend("Counter");
        var query = new Counter;
        query.save({
            words: url
        }).then(function (object) {

        })
    }
    $(function () {
        var Counter = AV.Object.extend("Counter");
        addCount(Counter);
        showTime(Counter);
    });
</script>
</body>
</html>
